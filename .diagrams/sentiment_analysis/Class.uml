@startuml Sentiment_Analysis_Class
!theme plain

package "Django Models - models.py" {
  
  class SentimentAnalysis {
    +id: BigAutoField
    +product: ForeignKey(Product)
    +opinion: OneToOneField(Opinion)
    +sentiment_score: DecimalField(max_digits=5, decimal_places=3)
    +sentiment_category: CharField[positive|neutral|negative]
    +analyzed_at: DateTimeField(auto_now_add=True)
    --
    +SENTIMENT_CHOICES: list
    +Meta: db_table = 'method_sentiment_analysis'
    +Meta: indexes = ['product', 'sentiment_category']
  }

  class ProductSentimentSummary {
    +id: BigAutoField
    +product: OneToOneField(Product, related_name='sentiment_summary')
    +average_sentiment_score: DecimalField(max_digits=5, decimal_places=3)
    +positive_count: PositiveIntegerField(default=0)
    +neutral_count: PositiveIntegerField(default=0)
    +negative_count: PositiveIntegerField(default=0)
    +total_opinions: PositiveIntegerField(default=0)
    +updated_at: DateTimeField(auto_now=True)
    --
    +Meta: db_table = 'method_product_sentiment_summary'
  }
  
  class Opinion {
    +id: BigAutoField
    +product: ForeignKey(Product)
    +user: ForeignKey(User)
    +content: TextField
    +rating: PositiveIntegerField
    --
    +Meta: constraints = [CheckConstraint(rating 1-5)]
    +Meta: unique_together = ('user', 'product')
  }
  
  class Product {
    +id: AutoField
    +name: CharField(100)
    +price: DecimalField
    +description: TextField
    +categories: ManyToManyField
    +tags: ManyToManyField
  }
}

package "Custom Algorithm - custom_recommendation_engine.py" {
  
  class CustomSentimentAnalysis {
    -positive_words: set (200+ words)
    -negative_words: set (200+ words)
    -intensifiers: set
    -negations: set
    -positive_bigrams: set
    -negative_bigrams: set
    -window_size: int = 300
    -window_overlap: int = 50
    --
    +analyze_sentiment(text): tuple[float, str]
    +analyze_product_sentiment(product): dict
    +_analyze_long_text_with_sliding_window(): tuple
    +_analyze_text_segment(text): tuple
    +_analyze_bigrams(words): dict
    +_check_negation_context(words, index): bool
    +_calculate_intensity_multiplier(words, index): float
    +_tokenize_text(text): list
    --
    Base Formula (Liu, B. 2012):
    score = (positive - negative) / total_words
    
    Multi-Source Formula:
    Final_Score = (OpinionÃ—0.40) + (DescÃ—0.25) +
                  (NameÃ—0.15) + (SpecÃ—0.12) + (CatÃ—0.08)
    
    Sources Analyzed:
    ðŸ‘¥ Opinions (40% weight) - Customer reviews
    ðŸ“ Description (25% weight) - Product description
    ðŸ·ï¸ Name (15% weight) - Product name keywords
    ðŸ“‹ Specifications (12% weight) - Technical specs
    ðŸ—‚ï¸ Categories (8% weight) - Product categories
  }
}

package "API Views - sentiment_views.py" {
  
  class SentimentSearchAPIView {
    +permission_classes: [AllowAny]
    --
    +get(request): Response
    -filter_products_by_query()
    -order_by_sentiment_score()
    -attach_sentiment_data()
  }
  
  class FuzzySearchAPIView {
    +permission_classes: [AllowAny]
    --
    +get(request): Response
    +_simple_fuzzy_search(): list
    -match_price_range()
    -calculate_fuzzy_scores()
  }
}

package "Django Signals - signals.py" {
  
  class SentimentSignalHandlers {
    --
    +handle_sentiment_analysis(sender, instance, created, **kwargs)
    -update_product_sentiment_summary()
    -invalidate_sentiment_cache()
    --
    @receiver(post_save, sender=Opinion)
  }
}

package "Frontend Components" {
  
  class SearchModal_jsx {
    -searchTerm: string
    -searchResults: Array
    -isAdvanced: boolean
    -isLoading: boolean
    -error: string
    -priceRange: string
    -fuzzyThreshold: number = 0.6
    --
    +performSentimentSearch()
    +performFuzzySearch()
    +useEffect([searchTerm, isAdvanced]) - 300ms delay
    +handleProductClick()
    +handleAdvancedSearch()
    --
    Imports: AiOutlineSearch, AiOutlineInfoCircle
    Button: âœ• (text, 24px, bold, black on red)
    Tooltip: Multi-Source Sentiment Info
    Conditional: !isAdvanced && searchResults.length > 0
  }
  
  class SearchModal_scss {
    +search-modal-close: 36pxÃ—36px
    +info-icon: 36pxÃ—36px, rgba(59,130,246,0.1)
    +tooltip-content: gradient(#ffffff, #f8fafc)
    +search-modal-toggle: 36px height
    --
    Close button: color: rgb(0,0,0), font-size: 24px
    Info icon: blue accent, 18px SVG
    Tooltip: position: absolute, top: calc(100% + 12px)
    Hover effects: translateY(-2px), box-shadow
  }
  
  class ProductReviewAPIView {
    +permission_classes: [IsAuthenticated]
    --
    +post(request, product_id): Response
    -validate_user_purchased()
    -check_existing_review()
    -create_opinion_with_sentiment()
  }
}

SearchModal_jsx ..> SearchModal_scss : uses styles

package "Database Migration" {
  
  class Migration_0001_initial {
    +operations: CreateModel[]
    --
    Tworzy SentimentAnalysis
    i ProductSentimentSummary tables
    z indeksami i constraints
  }
}

package "Seeder - seed_db.py" {
  
  class Command {
    --
    +seed_sentiment_data()
    +seed_opinions()
    +create_sentiment_summaries_after_seeding()
    -process_opinions_for_sentiment()
  }
}

' Relationships
SentimentAnalysis ||--|| Opinion : opinion
SentimentAnalysis ||--|| Product : product
ProductSentimentSummary ||--|| Product : product (sentiment_summary)
Opinion ||--|| Product : product
Opinion ||--|| User : user

CustomSentimentAnalysis ..> SentimentAnalysis : creates
CustomSentimentAnalysis ..> ProductSentimentSummary : updates
SentimentSearchAPIView ..> ProductSentimentSummary : queries
SentimentSignalHandlers ..> CustomSentimentAnalysis : uses

SearchModal_jsx ..> SentimentSearchAPIView : calls API
SearchModal_jsx ..> FuzzySearchAPIView : calls API
ProductReviewAPIView ..> Opinion : creates
ProductReviewAPIView ..> SentimentSignalHandlers : triggers

Migration_0001_initial ..> SentimentAnalysis : creates table
Migration_0001_initial ..> ProductSentimentSummary : creates table
Command ..> CustomSentimentAnalysis : seeds data

@enduml