{"ast":null,"code":"/**\n * AdminUsers Component\n *\n * Authors: Dawid Olko & Piotr Smoła\n * Date: 2025-11-02\n * Version: 2.0\n *\n * Admin panel component for comprehensive user management (CRUD operations).\n * Manages customer accounts, roles, and displays user statistics.\n *\n * Features:\n *   - User CRUD operations (Create, Read, Update, Delete)\n *   - Role management (admin/client)\n *   - User search and filtering\n *   - Sorting by multiple fields (ID, email, username, role)\n *   - Pagination (10 users per page)\n *   - User statistics dashboard:\n *     * Total opinions/reviews count\n *     * Average rating\n *     * Top product category\n *     * Top product tag\n *   - Confirmation modals for destructive actions\n *   - Form validation\n *   - Loading states\n *\n * User Fields:\n *   - Email (required, unique, validated)\n *   - Username (required, unique)\n *   - First Name (optional)\n *   - Last Name (optional)\n *   - Role (admin/client)\n *\n * State Management:\n *   - customers: Array of all users\n *   - stats: User-related statistics\n *   - Form states: newEmail, newUsername, newFirstName, newLastName, newRole\n *   - Edit states: Separate state variables for editing mode\n *   - UI states: searchTerm, sortField, sortDirection, currentPage, loading\n *   - Modal states: Delete, add, and edit confirmation modals\n *\n * API Endpoints:\n *   - GET /api/users/ - Fetch all users (admin only)\n *   - POST /api/users/ - Create new user\n *   - PUT /api/users/:id/ - Update user\n *   - DELETE /api/users/:id/ - Delete user\n *   - GET /api/admin-stats/ - Fetch user statistics\n *\n * Validation:\n *   - Required fields: email, username\n *   - Email format validation\n *   - Unique email and username constraints\n *   - Role selection (admin/client only)\n *\n * Security:\n *   - Admin authentication required\n *   - JWT token validation\n *   - Confirmation modals for delete operations\n *\n * @component\n * @returns {React.ReactElement} Admin user management page with dashboard\n */import React,{useEffect,useState,useCallback}from\"react\";import{motion}from\"framer-motion\";import{Trash2,Edit,Search,ChevronLeft,ChevronRight,ChevronUp,ChevronDown}from\"lucide-react\";import axios from\"axios\";import config from\"../../config/config\";import StatCard from\"./StatCard\";import ConfirmationModal from\"./ConfirmationModal\";import{toast}from\"react-toastify\";import\"react-toastify/dist/ReactToastify.css\";import\"./AdminPanel.scss\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminUsers=()=>{const[customers,setCustomers]=useState([]);const[stats,setStats]=useState({totalOpinions:0,averageRating:0,topCategoryName:\"\",topTagName:\"\"});const[newEmail,setNewEmail]=useState(\"\");const[newUsername,setNewUsername]=useState(\"\");const[newFirstName,setNewFirstName]=useState(\"\");const[newLastName,setNewLastName]=useState(\"\");const[newRole,setNewRole]=useState(\"client\");const[editId,setEditId]=useState(null);const[editEmail,setEditEmail]=useState(\"\");const[editUsername,setEditUsername]=useState(\"\");const[editFirstName,setEditFirstName]=useState(\"\");const[editLastName,setEditLastName]=useState(\"\");const[editRole,setEditRole]=useState(\"\");const[searchTerm,setSearchTerm]=useState(\"\");const[filteredCustomers,setFilteredCustomers]=useState([]);const[sortField,setSortField]=useState(\"id\");const[sortDirection,setSortDirection]=useState(\"asc\");const[currentPage,setCurrentPage]=useState(1);const[customersPerPage]=useState(10);const[isDeleteModalOpen,setIsDeleteModalOpen]=useState(false);const[pendingDeleteId,setPendingDeleteId]=useState(null);const[isAddConfirmModalOpen,setIsAddConfirmModalOpen]=useState(false);const[isEditConfirmModalOpen,setIsEditConfirmModalOpen]=useState(false);const[loading,setLoading]=useState(false);useEffect(()=>{fetchCustomers();fetchStatsFromBackend();},[]);const handleFilteringAndSorting=useCallback(()=>{if(!customers.length)return;let data=[...customers];if(searchTerm.trim()!==\"\"){const term=searchTerm.toLowerCase().trim();data=data.filter(c=>{return c.email&&c.email.toLowerCase().includes(term)||c.username&&c.username.toLowerCase().includes(term)||c.first_name&&c.first_name.toLowerCase().includes(term)||c.last_name&&c.last_name.toLowerCase().includes(term)||c.role&&c.role.toLowerCase().includes(term)||c.id&&c.id.toString().includes(term);});}data.sort((a,b)=>{let fieldA=a[sortField];let fieldB=b[sortField];if(fieldA===null||fieldA===undefined)fieldA=\"\";if(fieldB===null||fieldB===undefined)fieldB=\"\";if(typeof fieldA!==\"string\")fieldA=String(fieldA);if(typeof fieldB!==\"string\")fieldB=String(fieldB);fieldA=fieldA.toLowerCase();fieldB=fieldB.toLowerCase();if(fieldA<fieldB)return sortDirection===\"asc\"?-1:1;if(fieldA>fieldB)return sortDirection===\"asc\"?1:-1;return 0;});setFilteredCustomers(data);if(data.length>0&&currentPage>Math.ceil(data.length/customersPerPage)){setCurrentPage(1);}else if(currentPage===0&&data.length>0){setCurrentPage(1);}},[customers,searchTerm,sortField,sortDirection,currentPage,customersPerPage]);useEffect(()=>{handleFilteringAndSorting();},[handleFilteringAndSorting]);const fetchCustomers=async()=>{setLoading(true);const token=localStorage.getItem(\"access\");try{const res=await axios.get(`${config.apiUrl}/api/users/`,{headers:{Authorization:`Bearer ${token}`}});setCustomers(res.data);setFilteredCustomers(res.data);setLoading(false);}catch(err){console.error(\"Error fetching customers:\",err);toast.error(\"Failed to fetch customers. Please try again.\");setLoading(false);}};const fetchStatsFromBackend=async()=>{const token=localStorage.getItem(\"access\");try{const res=await axios.get(`${config.apiUrl}/api/admin-dashboard-stats/`,{headers:{Authorization:`Bearer ${token}`}});setStats({totalOpinions:res.data.totalOpinions||0,averageRating:res.data.averageRating||0,topCategoryName:res.data.topCategoryName||\"\",topTagName:res.data.topTagName||\"\"});}catch(err){console.error(\"Error fetching new stats (opinions, rating, etc.):\",err);toast.error(\"Failed to fetch statistics. Please try again.\");}};const handleAddUserClick=e=>{e.preventDefault();if(!newEmail||!newUsername){toast.error(\"Email and Username are required to create a user.\");return;}setIsAddConfirmModalOpen(true);};const handleAddUser=async()=>{setLoading(true);const token=localStorage.getItem(\"access\");try{await axios.post(`${config.apiUrl}/api/users/`,{username:newUsername,email:newEmail,first_name:newFirstName,last_name:newLastName,role:newRole,password:\"DefaultPass123\"},{headers:{Authorization:`Bearer ${token}`}});fetchCustomers();setNewEmail(\"\");setNewUsername(\"\");setNewFirstName(\"\");setNewLastName(\"\");setNewRole(\"client\");toast.success(\"User added successfully!\");}catch(err){console.error(\"Error creating new user:\",err);toast.error(\"Error occurred while creating user. Please try again.\");}finally{setIsAddConfirmModalOpen(false);setLoading(false);}};const startEdit=cust=>{setEditId(cust.id);setEditEmail(cust.email||\"\");setEditUsername(cust.username||\"\");setEditFirstName(cust.first_name||\"\");setEditLastName(cust.last_name||\"\");setEditRole(cust.role||\"client\");};const cancelEdit=()=>{setEditId(null);setEditEmail(\"\");setEditUsername(\"\");setEditFirstName(\"\");setEditLastName(\"\");setEditRole(\"\");};const handleEditClick=e=>{e.preventDefault();if(!editEmail||!editUsername){toast.error(\"Email and Username cannot be empty.\");return;}setIsEditConfirmModalOpen(true);};const handleEditSubmit=async()=>{setLoading(true);const token=localStorage.getItem(\"access\");try{await axios.put(`${config.apiUrl}/api/users/${editId}/`,{email:editEmail,username:editUsername,first_name:editFirstName,last_name:editLastName,role:editRole,password:\"DefaultPass123\"},{headers:{Authorization:`Bearer ${token}`}});fetchCustomers();cancelEdit();toast.success(\"User updated successfully!\");}catch(err){console.error(\"Error updating user:\",err);toast.error(\"Error occurred while updating user. Please try again.\");}finally{setIsEditConfirmModalOpen(false);setLoading(false);}};const handleDeleteClick=userId=>{setPendingDeleteId(userId);setIsDeleteModalOpen(true);};const handleDelete=async()=>{if(!pendingDeleteId)return;setLoading(true);const token=localStorage.getItem(\"access\");try{await axios.delete(`${config.apiUrl}/api/users/${pendingDeleteId}/`,{headers:{Authorization:`Bearer ${token}`}});fetchCustomers();toast.success(\"User deleted successfully!\");}catch(error){console.error(\"Error deleting user:\",error);toast.error(\"Failed to delete user. Please try again.\");}finally{setIsDeleteModalOpen(false);setPendingDeleteId(null);setLoading(false);}};const handleSort=field=>{if(sortField===field){setSortDirection(sortDirection===\"asc\"?\"desc\":\"asc\");}else{setSortField(field);setSortDirection(\"asc\");}};const renderSortIcon=field=>{if(sortField!==field)return null;return sortDirection===\"asc\"?/*#__PURE__*/_jsx(ChevronUp,{size:14}):/*#__PURE__*/_jsx(ChevronDown,{size:14});};const handleSearchChange=e=>{setSearchTerm(e.target.value);setCurrentPage(1);};const paginate=pageNumber=>{setCurrentPage(pageNumber);};const nextPage=()=>{const maxPage=Math.ceil(filteredCustomers.length/customersPerPage);if(currentPage<maxPage){setCurrentPage(prevPage=>prevPage+1);}};const prevPage=()=>{if(currentPage>1){setCurrentPage(prevPage=>prevPage-1);}};const indexOfLast=currentPage*customersPerPage;const indexOfFirst=indexOfLast-customersPerPage;const currentSlice=filteredCustomers.slice(indexOfFirst,indexOfLast);const totalPages=Math.ceil(filteredCustomers.length/customersPerPage);const renderPaginationButtons=()=>{const pageNumbers=[];const maxVisibleButtons=5;if(totalPages<=maxVisibleButtons){for(let i=1;i<=totalPages;i++){pageNumbers.push(i);}}else{let startPage=Math.max(1,currentPage-Math.floor(maxVisibleButtons/2));let endPage=startPage+maxVisibleButtons-1;if(endPage>totalPages){endPage=totalPages;startPage=Math.max(1,endPage-maxVisibleButtons+1);}for(let i=startPage;i<=endPage;i++){pageNumbers.push(i);}}return pageNumbers.map(number=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(number),className:`pagination-number ${currentPage===number?\"active\":\"\"}`,children:number},number));};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"admin-content\",children:[/*#__PURE__*/_jsxs(\"main\",{className:\"admin-products\",children:[/*#__PURE__*/_jsxs(motion.div,{className:\"stat_Cards\",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:1},children:[/*#__PURE__*/_jsx(StatCard,{name:\"All Opinions\",icon:Edit,value:stats.totalOpinions.toLocaleString(),color:\"#6366F1\",variant:\"first\"}),/*#__PURE__*/_jsx(StatCard,{name:\"Average Rating\",icon:Edit,value:stats.averageRating,color:\"#10B981\",variant:\"third\"}),/*#__PURE__*/_jsx(StatCard,{name:\"Top Category\",icon:Edit,value:stats.topCategoryName||\"—\",color:\"#F59E0B\",variant:\"fourth\"}),/*#__PURE__*/_jsx(StatCard,{name:\"Top Tag\",icon:Edit,value:stats.topTagName||\"—\",color:\"#EF4444\",variant:\"second\"})]}),/*#__PURE__*/_jsxs(motion.div,{className:\"product-form\",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:0.1},children:[/*#__PURE__*/_jsx(\"h4\",{className:\"product-form__title\",children:\"Add new user\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleAddUserClick,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:newEmail,onChange:e=>setNewEmail(e.target.value),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newUsername,onChange:e=>setNewUsername(e.target.value),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"First Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newFirstName,onChange:e=>setNewFirstName(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Last Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newLastName,onChange:e=>setNewLastName(e.target.value)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Role\"}),/*#__PURE__*/_jsxs(\"select\",{value:newRole,onChange:e=>setNewRole(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"client\",children:\"Client\"}),/*#__PURE__*/_jsx(\"option\",{value:\"admin\",children:\"Admin\"})]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn-primary\",children:\"Add User\"})]})]}),/*#__PURE__*/_jsxs(motion.div,{className:\"product-table-container\",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:0.2},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"product-table-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"All Customers\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search customers...\",onChange:handleSearchChange,value:searchTerm}),/*#__PURE__*/_jsx(Search,{className:\"search-icon\",size:18})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-wrapper\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"product-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{onClick:()=>handleSort(\"id\"),className:\"sortable-header\",style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"ID\"}),renderSortIcon(\"id\")]})}),/*#__PURE__*/_jsx(\"th\",{onClick:()=>handleSort(\"email\"),className:\"sortable-header\",style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Email\"}),renderSortIcon(\"email\")]})}),/*#__PURE__*/_jsx(\"th\",{onClick:()=>handleSort(\"username\"),className:\"sortable-header\",style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Username\"}),renderSortIcon(\"username\")]})}),/*#__PURE__*/_jsx(\"th\",{onClick:()=>handleSort(\"first_name\"),className:\"sortable-header\",style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"First Name\"}),renderSortIcon(\"first_name\")]})}),/*#__PURE__*/_jsx(\"th\",{onClick:()=>handleSort(\"last_name\"),className:\"sortable-header\",style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Last Name\"}),renderSortIcon(\"last_name\")]})}),/*#__PURE__*/_jsx(\"th\",{onClick:()=>handleSort(\"role\"),className:\"sortable-header\",style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Role\"}),renderSortIcon(\"role\")]})}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:currentSlice.length>0?currentSlice.map(cust=>editId===cust.id?/*#__PURE__*/_jsxs(motion.tr,{initial:{opacity:0},animate:{opacity:1},transition:{duration:0.3},className:\"edit-row\",children:[/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:cust.id}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:editEmail,onChange:e=>setEditEmail(e.target.value)})}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:editUsername,onChange:e=>setEditUsername(e.target.value)})}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:editFirstName,onChange:e=>setEditFirstName(e.target.value)})}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:editLastName,onChange:e=>setEditLastName(e.target.value)})}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"select\",{value:editRole,onChange:e=>setEditRole(e.target.value),style:{textAlign:\"center\"},children:[/*#__PURE__*/_jsx(\"option\",{value:\"client\",children:\"Client\"}),/*#__PURE__*/_jsx(\"option\",{value:\"admin\",children:\"Admin\"})]})}),/*#__PURE__*/_jsxs(\"td\",{className:\"action-cell\",style:{textAlign:\"center\"},children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleEditClick,className:\"btn-save\",children:\"Save\"}),/*#__PURE__*/_jsx(\"button\",{onClick:cancelEdit,className:\"btn-cancel\",children:\"Cancel\"})]})]},cust.id):/*#__PURE__*/_jsxs(motion.tr,{initial:{opacity:0},animate:{opacity:1},transition:{duration:0.3},children:[/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:cust.id}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:cust.email}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:cust.username}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:cust.first_name}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:cust.last_name}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:cust.role}),/*#__PURE__*/_jsxs(\"td\",{className:\"action-cell\",style:{textAlign:\"center\"},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>startEdit(cust),className:\"btn-edit\",children:/*#__PURE__*/_jsx(Edit,{size:18})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeleteClick(cust.id),className:\"btn-delete\",children:/*#__PURE__*/_jsx(Trash2,{size:18})})]})]},cust.id)):/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"7\",className:\"no-results\",children:\"No users found matching your search criteria\"})})})]})}),filteredCustomers.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"pagination-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pagination-info\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"pagination-text\",children:[\"Displaying \",indexOfFirst+1,\" to\",\" \",Math.min(indexOfLast,filteredCustomers.length),\" of\",\" \",filteredCustomers.length,\" users\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pagination-controls\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:prevPage,disabled:currentPage===1,className:`pagination-button ${currentPage===1?\"disabled\":\"\"}`,children:[/*#__PURE__*/_jsx(ChevronLeft,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:\"<\"})]}),renderPaginationButtons(),/*#__PURE__*/_jsxs(\"button\",{onClick:nextPage,disabled:currentPage>=totalPages,className:`pagination-button ${currentPage>=totalPages?\"disabled\":\"\"}`,children:[/*#__PURE__*/_jsx(ChevronRight,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:\">\"})]})]})]})]})]}),/*#__PURE__*/_jsx(ConfirmationModal,{isOpen:isDeleteModalOpen,onClose:()=>setIsDeleteModalOpen(false),onConfirm:handleDelete,title:\"Confirm Deletion\",message:\"Are you sure you want to delete this user? This action cannot be undone.\"}),/*#__PURE__*/_jsx(ConfirmationModal,{isOpen:isEditConfirmModalOpen,onClose:()=>setIsEditConfirmModalOpen(false),onConfirm:handleEditSubmit,title:\"Confirm Update\",message:\"Do you want to save changes to this user?\"}),/*#__PURE__*/_jsx(ConfirmationModal,{isOpen:isAddConfirmModalOpen,onClose:()=>setIsAddConfirmModalOpen(false),onConfirm:handleAddUser,title:\"Confirm Addition\",message:\"Do you want to add this new user?\"})]});};export default AdminUsers;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}