{"ast":null,"code":"import{createContext,useState,useEffect}from\"react\";import{jwtDecode}from\"jwt-decode\";import config from\"../config/config\";/**\n * AuthContext - Authentication state management for SmartRecommender\n *\n * Provides global authentication state using React Context API.\n * Manages JWT tokens, user session, and authentication lifecycle.\n *\n * Features:\n *   - JWT token management with expiration checking\n *   - Automatic token validation on mount\n *   - User data persistence in localStorage\n *   - Automatic logout on token expiration\n *   - User profile fetching from API\n *\n * Context Values:\n *   - user: Current user object (decoded JWT + API data)\n *   - token: JWT access token\n *   - login(token): Store token and authenticate user\n *   - logout(): Clear session and remove tokens\n *   - setUser(user): Update user state manually\n *\n * Token Structure (JWT):\n *   - exp: Expiration timestamp\n *   - user_id: User database ID\n *   - email: User email address\n *   - role: User role ('admin' or 'client')\n *\n * @context\n */import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();/**\n * AuthProvider Component\n *\n * Wraps application with authentication context provider.\n * Automatically validates JWT tokens and manages user session.\n *\n * @component\n * @param {Object} props\n * @param {React.ReactNode} props.children - Child components\n * @returns {React.ReactElement} Context provider with auth state\n */export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(()=>{const savedUser=localStorage.getItem(\"loggedUser\");return savedUser?JSON.parse(savedUser):null;});const[token,setToken]=useState(localStorage.getItem(\"access\")||null);useEffect(()=>{if(token){try{const decoded=jwtDecode(token);const currentTime=Date.now()/1000;if(decoded.exp<currentTime){logout();}else if(!user){setUser(decoded);fetchUserData(token);}}catch(error){console.error(\"Błąd dekodowania tokena:\",error);logout();}}},[token,user]);const fetchUserData=async authToken=>{try{const response=await fetch(`${config.apiUrl}/api/user/`,{method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:`Bearer ${authToken}`}});if(!response.ok){throw new Error(\"Failed to fetch user data\");}const data=await response.json();setUser(data);localStorage.setItem(\"loggedUser\",JSON.stringify(data));}catch(error){console.error(\"Error fetching user data:\",error);}};const login=newToken=>{localStorage.setItem(\"access\",newToken);setToken(newToken);};const logout=()=>{localStorage.removeItem(\"access\");localStorage.removeItem(\"loggedUser\");setUser(null);setToken(null);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,token,login,logout,setUser},children:children});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}