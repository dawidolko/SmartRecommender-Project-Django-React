{"ast":null,"code":"/**\n * NewProducts Component\n *\n * Authors: Dawid Olko & Piotr Smoła\n * Date: 2025-11-02\n * Version: 2.0\n *\n * Homepage component displaying personalized product recommendations or\n * random products for non-authenticated users.\n *\n * Features:\n *   - Personalized recommendations for logged-in users\n *   - Random products for guests\n *   - Multiple recommendation algorithms:\n *     * Collaborative Filtering - Based on similar users\n *     * Content-Based Filtering - Based on product attributes\n *     * Fuzzy Logic - Based on fuzzy user profile\n *   - Algorithm name display in section title\n *   - Animated entrance with Framer Motion\n *   - Intersection Observer (appears when scrolled into view)\n *   - Loading skeleton/state\n *   - Navigation to shop page\n *\n * Algorithm Selection:\n *   1. Checks user's active algorithm preference from settings\n *   2. Falls back to collaborative filtering if not set\n *   3. For guests: displays random products\n *\n * API Endpoints:\n *   - GET /api/recommendation-settings/ - Get user's algorithm preference\n *   - GET /api/recommendation-preview/?algorithm={alg} - Get personalized recommendations\n *   - GET /api/random-products/ - Get random products for guests\n *\n * State Management:\n *   - randomProducts: Array of products to display (recommendations or random)\n *   - currentAlgorithm: Active recommendation algorithm name\n *   - isLoading: Loading state for async fetch\n *   - isInView: Boolean from Intersection Observer (for animation trigger)\n *\n * Display Logic:\n *   - Authenticated user with valid recommendations → Show recommended products\n *   - Authenticated user without recommendations → Show random products\n *   - Guest user → Show random products\n *\n * Animation:\n *   - Uses Framer Motion's useInView hook\n *   - Triggers animation when component scrolls into viewport\n *   - once: true - Animation plays only once\n *\n * @component\n * @returns {React.ReactElement} Product recommendation section for homepage\n */import{useState,useEffect,useRef}from\"react\";import ShopProduct from\"../ShopContent/ShopProduct\";import{useNavigate}from\"react-router-dom\";import{motion,useInView}from\"framer-motion\";import AnimationVariants from\"../AnimationVariants/AnimationVariants\";import axios from\"axios\";import config from\"../../config/config\";import{mockAPI,PLACEHOLDER_IMAGE}from\"../../utils/mockData\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const NewProducts=()=>{const[randomProducts,setRandomProducts]=useState([]);const[currentAlgorithm,setCurrentAlgorithm]=useState(null);const[isLoading,setIsLoading]=useState(true);const ref=useRef();const isInView=useInView(ref,{once:true});const navigate=useNavigate();useEffect(()=>{const fetchData=async()=>{setIsLoading(true);try{if(config.useMockData){// Use mock data for GitHub Pages\nawait fetchProducts(null,null);}else{const token=localStorage.getItem(\"access\");if(token){const settingsResponse=await axios.get(`${config.apiUrl}/api/recommendation-settings/`,{headers:{Authorization:`Bearer ${token}`}});const algorithm=settingsResponse.data.active_algorithm||\"collaborative\";setCurrentAlgorithm(algorithm);await fetchProducts(algorithm,token);}else{await fetchProducts(null,null);}}}catch(error){console.error(\"Error in initial fetch:\",error);}finally{setIsLoading(false);}};fetchData();},[]);const fetchProducts=async(algorithm,token)=>{try{if(config.useMockData){// Use mock data for GitHub Pages\nconst data=await mockAPI.getRandomProducts(9);const formattedProducts=data.map(product=>{var _product$categories,_product$categories$;return{id:product.id,name:product.name,price:parseFloat(product.price),old_price:product.old_price?parseFloat(product.old_price):null,imgs:[PLACEHOLDER_IMAGE],category:((_product$categories=product.categories)===null||_product$categories===void 0?void 0:(_product$categories$=_product$categories[0])===null||_product$categories$===void 0?void 0:_product$categories$.name)||\"N/A\"};});setRandomProducts(formattedProducts);return;}if(token&&algorithm){try{const previewResponse=await axios.get(`${config.apiUrl}/api/recommendation-preview/?algorithm=${algorithm}`,{headers:{Authorization:`Bearer ${token}`}});if(previewResponse.data&&previewResponse.data.length>0){const formattedProducts=previewResponse.data.map(product=>{var _product$categories2;return{id:product.id,name:product.name,price:parseFloat(product.price),old_price:product.old_price?parseFloat(product.old_price):null,imgs:product.photos.map(photo=>`${config.apiUrl}/media/${photo.path}`),category:((_product$categories2=product.categories)===null||_product$categories2===void 0?void 0:_product$categories2[0])||\"N/A\"};});setRandomProducts(formattedProducts.slice(0,9));return;}}catch(error){console.error(\"Error fetching recommendations:\",error);}}const response=await axios.get(`${config.apiUrl}/api/random-products/`);const formattedProducts=response.data.map(product=>{var _product$categories3;return{id:product.id,name:product.name,price:parseFloat(product.price),old_price:product.old_price?parseFloat(product.old_price):null,imgs:product.photos.map(photo=>`${config.apiUrl}/media/${photo.path}`),category:((_product$categories3=product.categories)===null||_product$categories3===void 0?void 0:_product$categories3[0])||\"N/A\"};});setRandomProducts(formattedProducts.slice(0,9));}catch(error){console.error(\"Error fetching products:\",error);}};const getTitle=()=>{if(currentAlgorithm){return currentAlgorithm===\"collaborative\"?\"Recommended for You (Collaborative Filtering)\":currentAlgorithm===\"content_based\"?\"Recommended for You (Content-Based)\":currentAlgorithm===\"fuzzy_logic\"?\"Recommended for You (Fuzzy Logic)\":\"Recommended for You\";}return\"Our Latest Products\";};if(isLoading){return/*#__PURE__*/_jsx(motion.section,{variants:AnimationVariants.slideIn,initial:\"initial\",animate:isInView?\"animate\":\"initial\",ref:ref,className:\"shop container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"})});}return/*#__PURE__*/_jsxs(motion.section,{variants:AnimationVariants.slideIn,initial:\"initial\",animate:isInView?\"animate\":\"initial\",ref:ref,className:\"shop container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"shop__title\",children:getTitle()}),/*#__PURE__*/_jsx(\"div\",{className:\"shop__products\",children:randomProducts.length>0?randomProducts.map(product=>/*#__PURE__*/_jsx(ShopProduct,{...product},product.id)):/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/shop\"),className:\"shop__navigate\",children:\"Explore All Products\"})]});};export default NewProducts;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}