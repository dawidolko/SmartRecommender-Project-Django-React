{"ast":null,"code":"/**\n * ClientOrders Component\n *\n * Authors: Dawid Olko & Piotr Smoła\n * Date: 2025-11-02\n * Version: 2.0\n *\n * Client panel component for viewing order history and managing product reviews.\n * Displays user's orders with detailed information and review submission functionality.\n *\n * Features:\n *   - Order history list with status tracking\n *   - Search functionality (by order ID, status, date)\n *   - Sorting by date, status, total amount\n *   - Pagination (10 orders per page)\n *   - Order details modal with product list\n *   - Product review submission\n *   - Star rating system\n *   - Status color coding\n *   - Date formatting\n *   - Total amount calculation per order\n *   - Expandable order items view\n *\n * Order Status Types:\n *   - Pending - Order created, awaiting processing\n *   - Processing - Order being prepared\n *   - Shipped - Order dispatched\n *   - Delivered - Order received by customer\n *   - Cancelled - Order cancelled\n *\n * Review System:\n *   - 5-star rating scale\n *   - Text review (optional)\n *   - One review per product per user\n *   - Submit from order details modal\n *\n * State Management:\n *   - orders: Array of user's orders\n *   - filteredOrders: Orders after search/filter/sort\n *   - sortKey: Field to sort by (date, status, total)\n *   - sortOrder: Sort direction ('asc' or 'desc')\n *   - searchTerm: Current search query\n *   - currentPage: Active pagination page\n *   - isModalOpen: Order details modal visibility\n *   - isReviewModalOpen: Review submission modal visibility\n *   - selectedOrder: Order currently viewed in modal\n *   - selectedProduct: Product selected for review\n *   - loading: Loading state for async operations\n *\n * API Endpoints:\n *   - GET /api/orders/ - Fetch user's orders\n *   - GET /api/client/orders/:id/ - Fetch specific order details\n *   - POST /api/products/:id/reviews/ - Submit product review\n *\n * Calculations:\n *   - Order Total = Σ(product_price × quantity) for all products\n *   - Date Formatting: \"MMM dd, yyyy\" format\n *\n * @component\n * @returns {React.ReactElement} Client orders page with history and reviews\n *//* eslint-disable react-hooks/exhaustive-deps */import React,{useEffect,useState}from\"react\";import axios from\"axios\";import{format}from\"date-fns\";import{ChevronUp,ChevronDown,ChevronLeft,ChevronRight,Search}from\"lucide-react\";import config from\"../../config/config\";import\"./ClientPanel.scss\";import Modal from\"./Modal\";import ReviewForm from\"./ReviewForm\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ClientOrders=()=>{const[orders,setOrders]=useState([]);const[sortKey,setSortKey]=useState(\"date\");const[sortOrder,setSortOrder]=useState(\"asc\");const[loading,setLoading]=useState(true);const[searchTerm,setSearchTerm]=useState(\"\");const[filteredOrders,setFilteredOrders]=useState([]);const[currentPage,setCurrentPage]=useState(1);const[ordersPerPage]=useState(10);const[isModalOpen,setIsModalOpen]=useState(false);const[isReviewModalOpen,setIsReviewModalOpen]=useState(false);const[selectedOrder,setSelectedOrder]=useState(null);const[selectedProduct,setSelectedProduct]=useState(null);const[orderLoading,setOrderLoading]=useState(false);const[orderError,setOrderError]=useState(null);const getStatusClass=status=>{switch(status){case\"Processing\":return\"status-processing\";case\"Shipped\":return\"status-shipped\";case\"Delivered\":return\"status-delivered\";case\"Cancelled\":return\"status-cancelled\";case\"Pending\":default:return\"status-pending\";}};useEffect(()=>{const token=localStorage.getItem(\"access\");setLoading(true);axios.get(`${config.apiUrl}/api/orders/`,{headers:{Authorization:`Bearer ${token}`}}).then(res=>{setOrders(res.data);setFilteredOrders(res.data);setLoading(false);}).catch(err=>{console.error(\"Error fetching orders:\",err);setLoading(false);});},[]);useEffect(()=>{handleFilteringAndSorting();},[searchTerm,sortKey,sortOrder,orders]);const handleFilteringAndSorting=()=>{if(!orders.length)return;let data=[...orders];if(searchTerm){const term=searchTerm.toLowerCase();data=data.filter(order=>{var _order$status;const idMatch=order.id.toString().includes(term);const statusMatch=(_order$status=order.status)===null||_order$status===void 0?void 0:_order$status.toLowerCase().includes(term);const orderDate=format(new Date(order.date_order),\"dd MMM yyyy, HH:mm\").toLowerCase();const dateMatch=orderDate.includes(term);return idMatch||statusMatch||dateMatch;});}data.sort((a,b)=>{let comp=0;if(sortKey===\"date\"){comp=new Date(a.date_order)-new Date(b.date_order);}else if(sortKey===\"status\"){comp=a.status.localeCompare(b.status);}else if(sortKey===\"id\"){comp=a.id-b.id;}return sortOrder===\"asc\"?comp:-comp;});setFilteredOrders(data);setCurrentPage(1);};const handleViewDetails=orderId=>{const token=localStorage.getItem(\"access\");setOrderLoading(true);setOrderError(null);axios.get(`${config.apiUrl}/api/client/orders/${orderId}/`,{headers:{Authorization:`Bearer ${token}`}}).then(res=>{setSelectedOrder(res.data);setOrderLoading(false);setIsModalOpen(true);}).catch(err=>{console.error(\"Error fetching order details:\",err);setOrderError(\"Failed to fetch order details\");setOrderLoading(false);});};const handleAddReview=product=>{if(product&&product.id){setSelectedProduct(product);setIsReviewModalOpen(true);}else{console.error(\"Invalid product object:\",product);}};const handleReviewSubmitted=reviewData=>{setIsReviewModalOpen(false);};const handleCloseModal=()=>{setIsModalOpen(false);setSelectedOrder(null);};const handleCloseReviewModal=()=>{setIsReviewModalOpen(false);setSelectedProduct(null);};const handleSort=column=>{if(sortKey===column){setSortOrder(sortOrder===\"asc\"?\"desc\":\"asc\");}else{setSortKey(column);setSortOrder(\"asc\");}};const handleSearch=value=>{setSearchTerm(value);};const renderSortIcon=column=>{if(sortKey!==column)return null;return sortOrder===\"asc\"?/*#__PURE__*/_jsx(ChevronUp,{size:14}):/*#__PURE__*/_jsx(ChevronDown,{size:14});};const indexOfLast=currentPage*ordersPerPage;const indexOfFirst=indexOfLast-ordersPerPage;const currentOrders=filteredOrders.slice(indexOfFirst,indexOfLast);const paginate=pageNumber=>setCurrentPage(pageNumber);const nextPage=()=>{if(currentPage<Math.ceil(filteredOrders.length/ordersPerPage)){setCurrentPage(currentPage+1);}};const prevPage=()=>{if(currentPage>1){setCurrentPage(currentPage-1);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"});}const tableCellStyle={textAlign:\"center\",verticalAlign:\"middle\"};const renderOrderDetails=()=>{if(orderLoading)return/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"});if(orderError)return/*#__PURE__*/_jsx(\"div\",{children:orderError});if(!selectedOrder)return/*#__PURE__*/_jsx(\"div\",{children:\"No order found.\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"order-detail-modal\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Date: \"}),format(new Date(selectedOrder.date_order),\"dd MMM yyyy, HH:mm\")]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status: \"}),/*#__PURE__*/_jsx(\"span\",{className:getStatusClass(selectedOrder.status),children:selectedOrder.status})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total:\"}),\" $\",parseFloat(selectedOrder.total).toFixed(2)]}),/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:\"1rem\"},children:\"Ordered Products:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"modal-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Image\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Quantity\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Price (each)\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:selectedOrder.order_products.map(op=>{const product=op.product;const imgSrc=product.photos&&product.photos.length>0?`${config.apiUrl}/media/${product.photos[0].path}`:`${config.apiUrl}/media/placeholder-product.png`;const price=product.price&&!isNaN(parseFloat(product.price))&&parseFloat(product.price)>0?parseFloat(product.price):0;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{style:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\",border:\"none\"},children:/*#__PURE__*/_jsx(\"img\",{src:imgSrc,alt:product.name,style:{width:\"100px\"},onError:e=>{e.target.onerror=null;e.target.src=`${config.apiUrl}/media/placeholder-product.png`;}})}),/*#__PURE__*/_jsx(\"td\",{c:true,style:{textAlign:\"center\"},children:product.name}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:op.quantity}),/*#__PURE__*/_jsxs(\"td\",{style:{textAlign:\"center\",width:\"85px\"},children:[\"$\",price.toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary review-btn2\",onClick:()=>handleAddReview(product),children:\"Add Review\"})})]},op.id||`${selectedOrder.id}-${product.id}`);})})]})})]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"client-main\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"product-table-container2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"product-table-header2\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Your Orders\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-container2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search orders... (ID, Status, Date)\",onChange:e=>handleSearch(e.target.value),value:searchTerm}),/*#__PURE__*/_jsx(Search,{className:\"search-icon\",size:18})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-wrapper\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"product-table2\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:tableCellStyle,onClick:()=>handleSort(\"id\"),className:\"sortable-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Order ID\"}),renderSortIcon(\"id\")]})}),/*#__PURE__*/_jsx(\"th\",{style:tableCellStyle,onClick:()=>handleSort(\"date\"),className:\"sortable-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Date\"}),renderSortIcon(\"date\")]})}),/*#__PURE__*/_jsx(\"th\",{style:tableCellStyle,onClick:()=>handleSort(\"status\"),className:\"sortable-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Status\"}),renderSortIcon(\"status\")]})}),/*#__PURE__*/_jsx(\"th\",{style:tableCellStyle,children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:currentOrders.length>0?currentOrders.map(order=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{style:tableCellStyle,children:order.id}),/*#__PURE__*/_jsx(\"td\",{style:tableCellStyle,children:format(new Date(order.date_order),\"dd MMM yyyy, HH:mm\")}),/*#__PURE__*/_jsx(\"td\",{style:tableCellStyle,children:/*#__PURE__*/_jsx(\"span\",{className:`status-badge ${getStatusClass(order.status)}`,children:order.status})}),/*#__PURE__*/_jsx(\"td\",{style:tableCellStyle,children:/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary\",onClick:()=>handleViewDetails(order.id),children:\"View Details\"})})]},order.id)):/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"4\",className:\"no-results\",children:\"No orders found matching your search criteria\"})})})]})}),filteredOrders.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"pagination-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pagination-info\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"pagination-text\",children:[\"Displaying \",indexOfFirst+1,\" to\",\" \",Math.min(indexOfLast,filteredOrders.length),\" of\",\" \",filteredOrders.length,\" orders\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pagination-controls\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:prevPage,disabled:currentPage===1,className:`pagination-button ${currentPage===1?\"disabled\":\"\"}`,children:[/*#__PURE__*/_jsx(ChevronLeft,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:\"<\"})]}),Array.from({length:Math.ceil(filteredOrders.length/ordersPerPage)}).map((_,index)=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(index+1),className:`pagination-number ${currentPage===index+1?\"active\":\"\"}`,children:index+1},index)).slice(Math.max(0,currentPage-3),Math.min(Math.ceil(filteredOrders.length/ordersPerPage),currentPage+2)),/*#__PURE__*/_jsxs(\"button\",{onClick:nextPage,disabled:currentPage>=Math.ceil(filteredOrders.length/ordersPerPage),className:`pagination-button ${currentPage>=Math.ceil(filteredOrders.length/ordersPerPage)?\"disabled\":\"\"}`,children:[/*#__PURE__*/_jsx(ChevronRight,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:\">\"})]})]})]})]}),/*#__PURE__*/_jsx(Modal,{isOpen:isModalOpen,onClose:handleCloseModal,title:selectedOrder?`Order #${selectedOrder.id} Details`:\"Order Details\",children:renderOrderDetails()}),/*#__PURE__*/_jsx(Modal,{isOpen:isReviewModalOpen,onClose:handleCloseReviewModal,title:\"Add Product Review\",children:selectedProduct&&/*#__PURE__*/_jsx(ReviewForm,{product:selectedProduct,onReviewSubmitted:handleReviewSubmitted,onClose:handleCloseReviewModal})})]});};export default ClientOrders;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}