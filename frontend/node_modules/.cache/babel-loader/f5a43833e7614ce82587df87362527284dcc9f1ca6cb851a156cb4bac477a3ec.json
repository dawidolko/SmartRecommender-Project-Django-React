{"ast":null,"code":"/**\n * AdminComplaints Component\n *\n * Authors: Dawid Olko & Piotr Smoła\n * Date: 2025-11-02\n * Version: 2.0\n *\n * Admin panel component for managing customer complaints and support tickets.\n * Provides complaint tracking, status management, and resolution workflow.\n *\n * Features:\n *   - Complaint list with detailed information\n *   - Status management (Pending → Resolved/Rejected)\n *   - Search functionality (by ID, order, cause, status)\n *   - Sorting by multiple fields (ID, order, status, date)\n *   - Pagination (10 complaints per page)\n *   - Complaint statistics dashboard:\n *     * Total complaints count\n *     * Pending complaints count\n *     * Resolved complaints count\n *     * Rejected complaints count\n *   - Expandable complaint details\n *   - Bulk status updates\n *   - Delete functionality\n *   - Date formatting\n *\n * Complaint Status Flow:\n *   1. Pending - Initial state when complaint is created\n *   2. Resolved - Complaint has been successfully addressed\n *   3. Rejected - Complaint was deemed invalid or rejected\n *\n * State Management:\n *   - complaints: Array of all complaints from database\n *   - filteredComplaints: Complaints after search/filter operations\n *   - statusChanges: Object tracking status updates {complaintId: newStatus}\n *   - searchTerm: Current search query\n *   - sortField: Active sorting field (id, order, status, date_complaint)\n *   - sortDirection: Sort direction ('asc' or 'desc')\n *   - currentPage: Active pagination page\n *   - stats: Dashboard statistics (total, pending, resolved, rejected)\n *   - loading: Loading state for async operations\n *\n * API Endpoints:\n *   - GET /api/complaints/ - Fetch all complaints (admin only)\n *   - PUT /api/complaints/:id/ - Update complaint status\n *   - DELETE /api/complaints/:id/ - Delete complaint\n *\n * Calculations:\n *   - Statistics: Real-time count aggregation by status\n *   - Filtering: Case-insensitive search across multiple fields\n *\n * @component\n * @returns {React.ReactElement} Admin complaints management page with dashboard\n */import React,{useEffect,useState,useCallback}from\"react\";import{motion}from\"framer-motion\";import{Search,ChevronLeft,ChevronRight,ChevronUp,ChevronDown,AlertCircle,Trash2}from\"lucide-react\";import axios from\"axios\";import config from\"../../config/config\";import StatCard from\"./StatCard\";import\"./AdminPanel.scss\";import{toast}from\"react-toastify\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminComplaints=()=>{const[complaints,setComplaints]=useState([]);const[filteredComplaints,setFilteredComplaints]=useState([]);const[statusChanges,setStatusChanges]=useState({});const[loading,setLoading]=useState(true);const[searchTerm,setSearchTerm]=useState(\"\");const[sortField,setSortField]=useState(\"id\");const[sortDirection,setSortDirection]=useState(\"desc\");const[currentPage,setCurrentPage]=useState(1);const[complaintsPerPage]=useState(10);const[stats,setStats]=useState({totalComplaints:0,pendingComplaints:0,resolvedComplaints:0,rejectedComplaints:0});useEffect(()=>{fetchComplaints();},[]);const fetchComplaints=async()=>{setLoading(true);const token=localStorage.getItem(\"access\");try{const res=await axios.get(`${config.apiUrl}/api/complaints/`,{headers:{Authorization:`Bearer ${token}`}});setComplaints(res.data);setFilteredComplaints(res.data);const data=res.data;const pending=data.filter(c=>c.status===\"Pending\").length;const resolved=data.filter(c=>c.status===\"Resolved\").length;const rejected=data.filter(c=>c.status===\"Rejected\").length;setStats({totalComplaints:data.length,pendingComplaints:pending,resolvedComplaints:resolved,rejectedComplaints:rejected});setLoading(false);}catch(err){console.error(\"Error fetching complaints:\",err);setLoading(false);}};const handleFilteringAndSorting=useCallback(()=>{if(!complaints.length)return;let data=[...complaints];data=data.filter(complaint=>{var _complaint$cause,_complaint$status;if(!searchTerm)return true;const term=searchTerm.toLowerCase();const idMatch=complaint.id.toString().includes(term);const orderMatch=complaint.order.toString().includes(term);const causeMatch=(_complaint$cause=complaint.cause)===null||_complaint$cause===void 0?void 0:_complaint$cause.toLowerCase().includes(term);const statusMatch=(_complaint$status=complaint.status)===null||_complaint$status===void 0?void 0:_complaint$status.toLowerCase().includes(term);return idMatch||orderMatch||causeMatch||statusMatch;});data.sort((a,b)=>{let fieldA=a[sortField]||\"\";let fieldB=b[sortField]||\"\";if(sortField===\"submission_date\"){fieldA=new Date(fieldA);fieldB=new Date(fieldB);}else if(typeof fieldA===\"string\"){fieldA=fieldA.toLowerCase();fieldB=fieldB.toLowerCase();}if(fieldA<fieldB)return sortDirection===\"asc\"?-1:1;if(fieldA>fieldB)return sortDirection===\"asc\"?1:-1;return 0;});setFilteredComplaints(data);},[complaints,searchTerm,sortField,sortDirection]);useEffect(()=>{handleFilteringAndSorting();},[handleFilteringAndSorting]);const handleSearch=value=>{setSearchTerm(value);setCurrentPage(1);};const handleStatusChange=(complaintId,newStatus)=>{setStatusChanges(prev=>({...prev,[complaintId]:newStatus}));};const handleUpdateStatus=async complaintId=>{const newStatus=statusChanges[complaintId];const token=localStorage.getItem(\"access\");if(!newStatus){return;}const complaint=complaints.find(c=>c.id===complaintId);if(!complaint){toast.error(\"Complaint not found.\");return;}const updatedComplaintData={cause:complaint.cause,order:complaint.order,status:newStatus};try{const response=await axios.put(`${config.apiUrl}/api/complaints/${complaintId}/`,updatedComplaintData,{headers:{Authorization:`Bearer ${token}`}});if(response.status===200){setComplaints(prev=>prev.map(c=>c.id===complaintId?{...c,status:newStatus}:c));setStatusChanges(prev=>{const{[complaintId]:_,...rest}=prev;return rest;});toast.success(\"Status updated successfully!\");}else{toast.error(\"Failed to update status. Please try again.\");}}catch(error){console.error(\"Error updating complaint:\",error.response?error.response.data:error.message);toast.error(\"Failed to update status. Please try again.\");}};const handleDelete=async complaintId=>{if(!window.confirm(\"Are you sure you want to delete this complaint?\"))return;const token=localStorage.getItem(\"access\");try{await axios.delete(`${config.apiUrl}/api/complaints/${complaintId}/`,{headers:{Authorization:`Bearer ${token}`}});setComplaints(prev=>prev.filter(c=>c.id!==complaintId));toast.success(\"Complaint deleted successfully!\");}catch(error){console.error(\"Error deleting complaint:\",error);toast.error(\"Failed to delete complaint. Please try again.\");}};const getStatusClass=status=>{switch(status){case\"Resolved\":return\"admin-status-resolved\";case\"Rejected\":return\"admin-status-rejected\";case\"Pending\":default:return\"admin-status-pending\";}};const handleSort=field=>{if(sortField===field){setSortDirection(sortDirection===\"asc\"?\"desc\":\"asc\");}else{setSortField(field);setSortDirection(\"asc\");}};const renderSortIcon=field=>{if(sortField!==field)return null;return sortDirection===\"asc\"?/*#__PURE__*/_jsx(ChevronUp,{size:14}):/*#__PURE__*/_jsx(ChevronDown,{size:14});};const formatDate=dateString=>{if(!dateString)return\"\";const date=new Date(dateString);return date.toLocaleString(\"en-GB\",{year:\"numeric\",month:\"2-digit\",day:\"2-digit\",hour:\"2-digit\",minute:\"2-digit\",hour12:false}).replace(\",\",\"\");};const indexOfLast=currentPage*complaintsPerPage;const indexOfFirst=indexOfLast-complaintsPerPage;const currentSlice=filteredComplaints.slice(indexOfFirst,indexOfLast);const paginate=pageNumber=>setCurrentPage(pageNumber);const nextPage=()=>{if(currentPage<Math.ceil(filteredComplaints.length/complaintsPerPage)){setCurrentPage(currentPage+1);}};const prevPage=()=>{if(currentPage>1){setCurrentPage(currentPage-1);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"admin-content\",children:/*#__PURE__*/_jsxs(\"main\",{className:\"admin-products\",children:[/*#__PURE__*/_jsxs(motion.div,{className:\"stat_Cards\",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:1},children:[/*#__PURE__*/_jsx(StatCard,{name:\"Total Complaints\",icon:AlertCircle,value:stats.totalComplaints.toLocaleString(),color:\"#6366F1\",variant:\"first\"}),/*#__PURE__*/_jsx(StatCard,{name:\"Pending Complaints\",icon:AlertCircle,value:stats.pendingComplaints.toLocaleString(),color:\"#F59E0B\",variant:\"fourth\"}),/*#__PURE__*/_jsx(StatCard,{name:\"Resolved Complaints\",icon:AlertCircle,value:stats.resolvedComplaints.toLocaleString(),color:\"#10B981\",variant:\"third\"}),/*#__PURE__*/_jsx(StatCard,{name:\"Rejected Complaints\",icon:AlertCircle,value:stats.rejectedComplaints.toLocaleString(),color:\"#EF4444\",variant:\"second\"})]}),/*#__PURE__*/_jsxs(motion.div,{className:\"product-table-container\",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:0.2},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"product-table-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"All Complaints\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search complaints...\",onChange:e=>handleSearch(e.target.value),value:searchTerm}),/*#__PURE__*/_jsx(Search,{className:\"search-icon\",size:18})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-wrapper\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"product-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{onClick:()=>handleSort(\"id\"),className:\"sortable-header\",style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"#\"}),renderSortIcon(\"id\")]})}),/*#__PURE__*/_jsx(\"th\",{onClick:()=>handleSort(\"order\"),className:\"sortable-header\",style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Order ID\"}),renderSortIcon(\"order\")]})}),/*#__PURE__*/_jsx(\"th\",{onClick:()=>handleSort(\"cause\"),className:\"sortable-header hide-responsive\",style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Cause\"}),renderSortIcon(\"cause\")]})}),/*#__PURE__*/_jsx(\"th\",{onClick:()=>handleSort(\"submission_date\"),className:\"sortable-header hide-responsive\",style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Submission Date\"}),renderSortIcon(\"submission_date\")]})}),/*#__PURE__*/_jsx(\"th\",{onClick:()=>handleSort(\"status\"),className:\"sortable-header\",style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Status\"}),renderSortIcon(\"status\")]})}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:currentSlice.length>0?currentSlice.map(complaint=>/*#__PURE__*/_jsxs(motion.tr,{initial:{opacity:0},animate:{opacity:1},transition:{duration:0.3},className:getStatusClass(complaint.status),children:[/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:complaint.id}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:complaint.order}),/*#__PURE__*/_jsx(\"td\",{className:\"hide-responsive\",style:{textAlign:\"center\"},children:complaint.cause}),/*#__PURE__*/_jsx(\"td\",{className:\"hide-responsive\",style:{textAlign:\"center\"},children:formatDate(complaint.submission_date)}),/*#__PURE__*/_jsx(\"td\",{style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(\"select\",{value:statusChanges[complaint.id]||complaint.status,onChange:e=>handleStatusChange(complaint.id,e.target.value),className:`admin-status-select ${getStatusClass(statusChanges[complaint.id]||complaint.status)}`,children:[/*#__PURE__*/_jsx(\"option\",{value:\"Pending\",children:\"Pending\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Resolved\",children:\"Resolved\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Rejected\",children:\"Rejected\"})]})}),/*#__PURE__*/_jsxs(\"td\",{className:\"action-cell\",style:{textAlign:\"center\"},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleUpdateStatus(complaint.id),className:\"btn-save\",disabled:!statusChanges[complaint.id]||statusChanges[complaint.id]===complaint.status,children:\"Update\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(complaint.id),className:\"btn-delete\",children:/*#__PURE__*/_jsx(Trash2,{size:18})})]})]},complaint.id)):/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"6\",className:\"no-results\",children:\"No complaints found matching your search criteria\"})})})]})}),filteredComplaints.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"pagination-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pagination-info\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"pagination-text\",children:[\"Displaying \",indexOfFirst+1,\" to\",\" \",Math.min(indexOfLast,filteredComplaints.length),\" of\",\" \",filteredComplaints.length,\" complaints\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pagination-controls\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:prevPage,disabled:currentPage===1,className:`pagination-button ${currentPage===1?\"disabled\":\"\"}`,children:[/*#__PURE__*/_jsx(ChevronLeft,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:\"<\"})]}),Array.from({length:Math.ceil(filteredComplaints.length/complaintsPerPage)}).map((_,index)=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(index+1),className:`pagination-number ${currentPage===index+1?\"active\":\"\"}`,children:index+1},index)).slice(Math.max(0,currentPage-3),Math.min(Math.ceil(filteredComplaints.length/complaintsPerPage),currentPage+2)),/*#__PURE__*/_jsxs(\"button\",{onClick:nextPage,disabled:currentPage>=Math.ceil(filteredComplaints.length/complaintsPerPage),className:`pagination-button ${currentPage>=Math.ceil(filteredComplaints.length/complaintsPerPage)?\"disabled\":\"\"}`,children:[/*#__PURE__*/_jsx(ChevronRight,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:\">\"})]})]})]})]})]})});};export default AdminComplaints;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}