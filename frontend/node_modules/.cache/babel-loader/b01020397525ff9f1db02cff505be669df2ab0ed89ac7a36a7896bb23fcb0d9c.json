{"ast":null,"code":"import{useContext,useState}from\"react\";import{useNavigate}from\"react-router-dom\";import{CartContext}from\"../ShopContext/ShopContext\";import CartModal from\"./CartModal\";import{toast}from\"react-toastify\";import axios from\"axios\";import config from\"../../config/config\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const TotalAmount=()=>{const{totalAmount,totalCartItems,resetCart,items}=useContext(CartContext);const navigate=useNavigate();const[isModalOpen,setIsModalOpen]=useState(false);const[isLoading,setIsLoading]=useState(false);const formattedTotalAmount=typeof totalAmount()===\"number\"?totalAmount().toFixed(2):\"0.00\";const handleCheckout=async()=>{const loggedUser=JSON.parse(localStorage.getItem(\"loggedUser\"));const token=localStorage.getItem(\"access\");if(!loggedUser||!token){toast.error(\"You must be logged in to complete the purchase.\",{position:\"top-center\",autoClose:3000,hideProgressBar:true,closeOnClick:true,pauseOnHover:true,draggable:true,progress:undefined,theme:\"colored\"});return;}const validItems=Object.entries(items).filter(_ref=>{let[itemId,quantity]=_ref;return quantity>0;});if(validItems.length===0){toast.error(\"Your cart is empty or contains items with zero quantity.\",{position:\"top-center\",autoClose:3000,hideProgressBar:true,closeOnClick:true,pauseOnHover:true,draggable:true,progress:undefined,theme:\"colored\"});return;}setIsLoading(true);try{await axios.post(`${config.apiUrl}/api/orders/`,{items:Object.fromEntries(validItems),total:totalAmount()},{headers:{Authorization:`Bearer ${token}`}});openModal();}catch(error){console.error(\"Error during checkout:\",error);toast.error(\"Checkout failed. Please try again.\",{position:\"top-center\",autoClose:3000,hideProgressBar:true,closeOnClick:true,pauseOnHover:true,draggable:true,progress:undefined,theme:\"colored\"});}finally{setIsLoading(false);}};const openModal=()=>{setIsModalOpen(true);};const closeModal=()=>{setIsModalOpen(false);resetCart();navigate(\"/client\");};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cart__info\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"cart__info-title\",children:\"Cart Total\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"cart__total-amount\",children:[\"Total Price: $\",formattedTotalAmount]}),/*#__PURE__*/_jsxs(\"p\",{className:\"cart__total-amount\",children:[\"Total Items: \",totalCartItems()]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart__buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"cart__btn\",onClick:()=>navigate(\"/shop\"),disabled:isLoading,children:\"Continue Shopping\"}),/*#__PURE__*/_jsx(\"button\",{className:\"cart__btn\",onClick:handleCheckout,disabled:isLoading,children:isLoading?\"Processing...\":\"Checkout\"})]}),/*#__PURE__*/_jsx(CartModal,{isOpen:isModalOpen,closeModal:closeModal})]}),isLoading&&/*#__PURE__*/_jsx(\"div\",{className:\"cart__loading-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"cart__loading-spinner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cart__spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Processing your order...\"})]})})]});};export default TotalAmount;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}