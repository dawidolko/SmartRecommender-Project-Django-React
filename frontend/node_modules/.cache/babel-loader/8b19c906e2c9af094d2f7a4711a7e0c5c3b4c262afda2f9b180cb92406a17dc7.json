{"ast":null,"code":"/* eslint-disable react-hooks/exhaustive-deps */import React,{useEffect,useState}from\"react\";import axios from\"axios\";import{format}from\"date-fns\";import{ChevronUp,ChevronDown,ChevronLeft,ChevronRight,Search}from\"lucide-react\";import\"./ClientPanel.scss\";import Modal from\"./Modal\";import config from\"../../config/config\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ClientComplaints=()=>{const[complaints,setComplaints]=useState([]);const[sortKey,setSortKey]=useState(\"date\");const[sortOrder,setSortOrder]=useState(\"asc\");const[loading,setLoading]=useState(true);const[searchTerm,setSearchTerm]=useState(\"\");const[filteredComplaints,setFilteredComplaints]=useState([]);const[currentPage,setCurrentPage]=useState(1);const[complaintsPerPage]=useState(10);const[isModalOpen,setIsModalOpen]=useState(false);const[selectedComplaint,setSelectedComplaint]=useState(null);const[complaintLoading,setComplaintLoading]=useState(false);const[complaintError,setComplaintError]=useState(null);const getStatusClass=status=>{switch(status){case\"Pending\":return\"status-pending\";case\"Resolved\":return\"status-resolved\";case\"Rejected\":return\"status-rejected\";default:return\"\";}};useEffect(()=>{const token=localStorage.getItem(\"access\");setLoading(true);axios.get(`${config.apiUrl}/api/complaints/`,{headers:{Authorization:`Bearer ${token}`}}).then(res=>{setComplaints(res.data);setFilteredComplaints(res.data);setLoading(false);}).catch(err=>{console.error(\"Error fetching complaints:\",err);setLoading(false);});},[]);useEffect(()=>{handleFilteringAndSorting();},[searchTerm,sortKey,sortOrder,complaints]);const handleFilteringAndSorting=()=>{if(!complaints.length)return;let data=[...complaints];if(searchTerm){const term=searchTerm.toLowerCase();data=data.filter(complaint=>{var _complaint$cause,_complaint$status;const idMatch=complaint.id.toString().includes(term);const orderMatch=complaint.order.toString().includes(term);const causeMatch=(_complaint$cause=complaint.cause)===null||_complaint$cause===void 0?void 0:_complaint$cause.toLowerCase().includes(term);const statusMatch=(_complaint$status=complaint.status)===null||_complaint$status===void 0?void 0:_complaint$status.toLowerCase().includes(term);const complaintDate=format(new Date(complaint.submission_date),\"dd MMM yyyy, HH:mm\").toLowerCase();const dateMatch=complaintDate.includes(term);return idMatch||orderMatch||causeMatch||statusMatch||dateMatch;});}data.sort((a,b)=>{let comp=0;if(sortKey===\"date\"){comp=new Date(a.submission_date)-new Date(b.submission_date);}else if(sortKey===\"status\"){comp=a.status.localeCompare(b.status);}else if(sortKey===\"id\"){comp=a.id-b.id;}else if(sortKey===\"order\"){comp=a.order-b.order;}else if(sortKey===\"cause\"){comp=a.cause.localeCompare(b.cause);}return sortOrder===\"asc\"?comp:-comp;});setFilteredComplaints(data);setCurrentPage(1);};const handleViewDetails=complaintId=>{const token=localStorage.getItem(\"access\");setComplaintLoading(true);setComplaintError(null);axios.get(`${config.apiUrl}/api/complaints/${complaintId}/`,{headers:{Authorization:`Bearer ${token}`}}).then(res=>{setSelectedComplaint(res.data);setComplaintLoading(false);setIsModalOpen(true);}).catch(err=>{console.error(\"Error fetching complaint details:\",err);setComplaintError(\"Failed to fetch complaint details\");setComplaintLoading(false);});};const handleCloseModal=()=>{setIsModalOpen(false);setSelectedComplaint(null);};const handleSort=column=>{if(sortKey===column){setSortOrder(sortOrder===\"asc\"?\"desc\":\"asc\");}else{setSortKey(column);setSortOrder(\"asc\");}};const handleSearch=value=>{setSearchTerm(value);};const renderSortIcon=column=>{if(sortKey!==column)return null;return sortOrder===\"asc\"?/*#__PURE__*/_jsx(ChevronUp,{size:14}):/*#__PURE__*/_jsx(ChevronDown,{size:14});};const indexOfLast=currentPage*complaintsPerPage;const indexOfFirst=indexOfLast-complaintsPerPage;const currentComplaints=filteredComplaints.slice(indexOfFirst,indexOfLast);const paginate=pageNumber=>setCurrentPage(pageNumber);const nextPage=()=>{if(currentPage<Math.ceil(filteredComplaints.length/complaintsPerPage)){setCurrentPage(currentPage+1);}};const prevPage=()=>{if(currentPage>1){setCurrentPage(currentPage-1);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"admin-content\",children:/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"})});}const tableCellStyle={textAlign:\"center\",verticalAlign:\"middle\"};const renderComplaintDetails=()=>{if(complaintLoading)return/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"});if(complaintError)return/*#__PURE__*/_jsx(\"div\",{children:complaintError});if(!selectedComplaint)return/*#__PURE__*/_jsx(\"div\",{children:\"No complaint found.\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"complaint-detail-modal\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Order ID:\"}),\" \",selectedComplaint.order]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Cause:\"}),\" \",selectedComplaint.cause]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:getStatusClass(selectedComplaint.status),children:selectedComplaint.status})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Submission Date:\"}),\" \",format(new Date(selectedComplaint.submission_date),\"dd MMM yyyy, HH:mm\")]})]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"client-main\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"product-table-container2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"product-table-header2\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"My Complaints\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-container2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search complaints... (ID, Order, Status, Cause, Date)\",onChange:e=>handleSearch(e.target.value),value:searchTerm}),/*#__PURE__*/_jsx(Search,{className:\"search-icon\",size:18})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-wrapper\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"product-table2\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:tableCellStyle,onClick:()=>handleSort(\"id\"),className:\"sortable-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"#\"}),renderSortIcon(\"id\")]})}),/*#__PURE__*/_jsx(\"th\",{style:tableCellStyle,onClick:()=>handleSort(\"order\"),className:\"sortable-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Order ID\"}),renderSortIcon(\"order\")]})}),/*#__PURE__*/_jsx(\"th\",{style:tableCellStyle,onClick:()=>handleSort(\"cause\"),className:\"sortable-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Cause\"}),renderSortIcon(\"cause\")]})}),/*#__PURE__*/_jsx(\"th\",{style:tableCellStyle,onClick:()=>handleSort(\"status\"),className:\"sortable-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Status\"}),renderSortIcon(\"status\")]})}),/*#__PURE__*/_jsx(\"th\",{style:tableCellStyle,onClick:()=>handleSort(\"date\"),className:\"sortable-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Submission Date\"}),renderSortIcon(\"date\")]})}),/*#__PURE__*/_jsx(\"th\",{style:tableCellStyle,children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:currentComplaints.length>0?currentComplaints.map(complaint=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{style:tableCellStyle,children:complaint.id}),/*#__PURE__*/_jsx(\"td\",{style:tableCellStyle,children:complaint.order}),/*#__PURE__*/_jsx(\"td\",{style:tableCellStyle,children:complaint.cause}),/*#__PURE__*/_jsx(\"td\",{style:tableCellStyle,children:/*#__PURE__*/_jsx(\"span\",{className:`status-badge ${getStatusClass(complaint.status)}`,children:complaint.status})}),/*#__PURE__*/_jsx(\"td\",{style:tableCellStyle,children:format(new Date(complaint.submission_date),\"dd MMM yyyy, HH:mm\")}),/*#__PURE__*/_jsx(\"td\",{style:tableCellStyle,children:/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary\",onClick:()=>handleViewDetails(complaint.id),children:\"View Details\"})})]},complaint.id)):/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"6\",className:\"no-results\",children:\"No complaints found matching your search criteria\"})})})]})}),filteredComplaints.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"pagination-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pagination-info\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"pagination-text\",children:[\"Displaying \",indexOfFirst+1,\" to\",\" \",Math.min(indexOfLast,filteredComplaints.length),\" of\",\" \",filteredComplaints.length,\" complaints\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pagination-controls\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:prevPage,disabled:currentPage===1,className:`pagination-button ${currentPage===1?\"disabled\":\"\"}`,children:[/*#__PURE__*/_jsx(ChevronLeft,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:\"<\"})]}),Array.from({length:Math.ceil(filteredComplaints.length/complaintsPerPage)}).map((_,index)=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(index+1),className:`pagination-number ${currentPage===index+1?\"active\":\"\"}`,children:index+1},index)).slice(Math.max(0,currentPage-3),Math.min(Math.ceil(filteredComplaints.length/complaintsPerPage),currentPage+2)),/*#__PURE__*/_jsxs(\"button\",{onClick:nextPage,disabled:currentPage>=Math.ceil(filteredComplaints.length/complaintsPerPage),className:`pagination-button ${currentPage>=Math.ceil(filteredComplaints.length/complaintsPerPage)?\"disabled\":\"\"}`,children:[/*#__PURE__*/_jsx(ChevronRight,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:\">\"})]})]})]})]}),/*#__PURE__*/_jsx(Modal,{isOpen:isModalOpen,onClose:handleCloseModal,title:selectedComplaint?`Complaint #${selectedComplaint.id} Details`:\"Complaint Details\",children:renderComplaintDetails()})]});};export default ClientComplaints;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}