{"ast":null,"code":"/**\n * ProductPage Component\n *\n * Authors: Dawid Olko & Piotr Smoła\n * Date: 2025-11-02\n * Version: 2.0\n *\n * Detailed product page component displaying comprehensive product information,\n * images, specifications, reviews, and personalized recommendations.\n *\n * Features:\n *   - Product image gallery with enlargement modal\n *   - Image carousel navigation (left/right arrows)\n *   - Add to cart functionality\n *   - Add to favorites (heart icon toggle)\n *   - Product specifications table\n *   - User reviews and ratings\n *   - Average rating calculation with star display\n *   - Similar products carousel (same category)\n *   - Tabbed interface (Description, Specifications, Reviews)\n *   - User interaction tracking (view, add_to_cart, favorite)\n *   - Breadcrumb navigation\n *   - Stock status indicator\n *   - Price display with old price strikethrough\n *\n * Interaction Tracking:\n *   - Sends analytics events to backend for recommendation algorithms\n *   - Types: 'view', 'add_to_cart', 'favorite'\n *   - Used by Collaborative Filtering and User Profiling\n *\n * Similar Products Algorithm:\n *   - Fetches products from same main category\n *   - Excludes current product\n *   - Displays in carousel format\n *   - Helps users discover related products\n *\n * State Management:\n *   - product: Full product details from API\n *   - loading: Loading state for product data\n *   - favorite: Boolean indicating if product is in favorites\n *   - currentIndex: Active image in gallery\n *   - isImageEnlarged: Modal state for enlarged image view\n *   - similarProducts: Array of related products\n *   - activeTab: Current tab (description/specifications/reviews)\n *   - items: Cart items from CartContext\n *\n * API Endpoints:\n *   - GET /api/product/:id/ - Fetch product details\n *   - GET /api/products/?category={category} - Fetch similar products\n *   - POST /api/interaction/ - Log user interaction\n *\n * Reviews Calculation:\n *   - Average Rating = Σ(ratings) / count(reviews)\n *   - Star Display: Full stars, half stars, empty stars\n *   - Review Count: Total number of opinions\n *\n * @component\n * @returns {React.ReactElement} Product detail page with gallery and recommendations\n */import React,{useState,useEffect,useContext,useCallback}from\"react\";import{useParams,useNavigate}from\"react-router-dom\";import{CartContext}from\"../ShopContext/ShopContext\";import{useFavorites}from\"../FavoritesContent/FavoritesContext\";import{AuthContext}from\"../../context/AuthContext\";import{toast}from\"react-toastify\";import{AiOutlineHeart,AiFillHeart,AiOutlineLeft,AiOutlineRight}from\"react-icons/ai\";import{FaStar}from\"react-icons/fa\";import Slider from\"react-slick\";import\"slick-carousel/slick/slick.css\";import\"slick-carousel/slick/slick-theme.css\";import\"./ProductPage.scss\";import config from\"../../config/config\";import{mockAPI}from\"../../utils/mockData\";import axios from\"axios\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProductPage=()=>{var _product$photos,_product$photos2,_product$photos3,_product$photos4,_product$photos5,_product$photos$curre,_product$photos$curre2;const{id}=useParams();const navigate=useNavigate();const{addToCart,items}=useContext(CartContext);const{addToFavorites,removeFromFavorites,isFavorite}=useFavorites();const{logout}=useContext(AuthContext);const[product,setProduct]=useState(null);const[loading,setLoading]=useState(true);const[favorite,setFavorite]=useState(false);const[currentIndex,setCurrentIndex]=useState(0);const[isImageEnlarged,setIsImageEnlarged]=useState(false);const[similarProducts,setSimilarProducts]=useState([]);const[similarProductsLoading,setSimilarProductsLoading]=useState(true);const[activeTab,setActiveTab]=useState(\"description\");const sendInteraction=useCallback(async type=>{const token=localStorage.getItem(\"access\");if(!token){return;}try{await axios.post(`${config.apiUrl}/api/interaction/`,{product_id:id,interaction_type:type},{headers:{Authorization:`Bearer ${token}`}});}catch(error){var _error$response;if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)!==401){console.error(\"Error sending interaction:\",error);}}},[id]);useEffect(()=>{const fetchProduct=async()=>{try{if(config.useMockData){const data=await mockAPI.getProductById(id);if(!data){toast.error(\"Product not found.\",{position:\"top-center\"});navigate(\"/shop\");return;}setProduct(data);setFavorite(isFavorite(data.id));}else{const response=await axios.get(`${config.apiUrl}/api/product/${id}/`);setProduct(response.data);setFavorite(isFavorite(response.data.id));sendInteraction(\"view\");}}catch(error){console.error(error);toast.error(\"Error loading product details.\",{position:\"top-center\"});if(error.message.includes(\"401\")||error.message.includes(\"unauthorized\")){logout();navigate(\"/login\");}}finally{setLoading(false);}};fetchProduct();},[id,isFavorite,logout,navigate,sendInteraction]);useEffect(()=>{const fetchSimilarProducts=async()=>{if(!product)return;setSimilarProductsLoading(true);try{if(config.useMockData){const data=await mockAPI.getRelatedProducts(product.id,10);setSimilarProducts(data);}else{if(!product.categories||product.categories.length===0){setSimilarProducts([]);setSimilarProductsLoading(false);return;}const fullCategory=product.categories[0];const mainCategory=fullCategory.split(\".\")[0];const token=localStorage.getItem(\"access\");const headers={};if(token)headers.Authorization=`Bearer ${token}`;const response=await axios.get(`${config.apiUrl}/api/products/`,{params:{category:mainCategory},headers:headers});const filteredProducts=response.data.filter(p=>p.id!==product.id&&p.categories.some(cat=>cat.startsWith(mainCategory)));const sortedProducts=filteredProducts.sort(()=>0.5-Math.random());setSimilarProducts(sortedProducts.slice(0,10));}}catch(error){console.error(\"Error fetching similar products:\",error);setSimilarProducts([]);}finally{setSimilarProductsLoading(false);}};if(product)fetchSimilarProducts();},[product]);if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"});if(!product)return/*#__PURE__*/_jsx(\"h2\",{children:\"Product not found.\"});const handleToggleFavorite=()=>{if(favorite){removeFromFavorites(product.id);toast.success(\"Removed from Favorites\",{position:\"top-center\"});}else{var _product$photos$;addToFavorites({id:product.id,img:`${config.apiUrl}/media/${(_product$photos$=product.photos[0])===null||_product$photos$===void 0?void 0:_product$photos$.path}`,name:product.name,price:product.price});sendInteraction(\"favorite\");toast.success(\"Added to Favorites\",{position:\"top-center\"});}setFavorite(!favorite);};const handleAddToCart=()=>{addToCart(product.id);sendInteraction(\"add_to_cart\");toast.success(\"Added to Cart\",{position:\"top-center\"});};const handlePrevImage=()=>{setCurrentIndex(prev=>prev===0?product.photos.length-1:prev-1);};const handleNextImage=()=>{setCurrentIndex(prev=>prev===product.photos.length-1?0:prev+1);};const handleImageEnlarge=()=>setIsImageEnlarged(true);const closeImageOverlay=e=>{if(e.target.className.includes(\"productPage__overlay\"))setIsImageEnlarged(false);};const quantityInCart=items[product.id]||0;const sliderSettings={dots:true,infinite:similarProducts.length>4,speed:500,slidesToShow:4,slidesToScroll:1,autoplay:true,autoplaySpeed:3000,responsive:[{breakpoint:1200,settings:{slidesToShow:3,slidesToScroll:1}},{breakpoint:768,settings:{slidesToShow:2,slidesToScroll:1}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]};const thumbnailSliderSettings={dots:false,infinite:(product===null||product===void 0?void 0:(_product$photos=product.photos)===null||_product$photos===void 0?void 0:_product$photos.length)>5,speed:300,slidesToShow:5,slidesToScroll:1,focusOnSelect:true,arrows:true,swipeToSlide:true,responsive:[{breakpoint:1500,settings:{slidesToShow:4,slidesToScroll:1,infinite:(product===null||product===void 0?void 0:(_product$photos2=product.photos)===null||_product$photos2===void 0?void 0:_product$photos2.length)>4,arrows:true}},{breakpoint:1024,settings:{slidesToShow:4,slidesToScroll:1,infinite:(product===null||product===void 0?void 0:(_product$photos3=product.photos)===null||_product$photos3===void 0?void 0:_product$photos3.length)>4,arrows:true}},{breakpoint:768,settings:{slidesToShow:3,slidesToScroll:1,infinite:(product===null||product===void 0?void 0:(_product$photos4=product.photos)===null||_product$photos4===void 0?void 0:_product$photos4.length)>3,arrows:true,swipeToSlide:true}},{breakpoint:480,settings:{slidesToShow:3,slidesToScroll:1,infinite:(product===null||product===void 0?void 0:(_product$photos5=product.photos)===null||_product$photos5===void 0?void 0:_product$photos5.length)>3,arrows:true,swipeToSlide:true}}]};const getSimpleCategory=category=>category.split(\".\")[0];const getCurrentCategory=()=>{var _product$categories;return product!==null&&product!==void 0&&(_product$categories=product.categories)!==null&&_product$categories!==void 0&&_product$categories[0]?getSimpleCategory(product.categories[0]):\"\";};const renderTabContent=()=>{switch(activeTab){case\"description\":return/*#__PURE__*/_jsx(\"div\",{className:\"productPage__tab-content\",children:/*#__PURE__*/_jsx(\"div\",{dangerouslySetInnerHTML:{__html:product.description}})});case\"specifications\":return/*#__PURE__*/_jsx(\"div\",{className:\"productPage__tab-content\",children:product.specifications.length>0?/*#__PURE__*/_jsx(\"table\",{className:\"productPage__specs-table\",children:/*#__PURE__*/_jsx(\"tbody\",{children:product.specifications.map((spec,index)=>{var _spec$parameter_name,_spec$specification;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"productPage__specs-param\",children:spec.parameter_name}),/*#__PURE__*/_jsx(\"td\",{className:\"productPage__specs-value\",children:spec.specification})]},`spec-${(_spec$parameter_name=spec===null||spec===void 0?void 0:spec.parameter_name)!==null&&_spec$parameter_name!==void 0?_spec$parameter_name:\"param\"}-${(_spec$specification=spec===null||spec===void 0?void 0:spec.specification)!==null&&_spec$specification!==void 0?_spec$specification:\"value\"}-${index}`);})})}):/*#__PURE__*/_jsx(\"p\",{children:\"No specifications available for this product.\"})});case\"reviews\":return/*#__PURE__*/_jsx(\"div\",{className:\"productPage__tab-content\",children:product.opinions.length>0?product.opinions.map(review=>/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__review\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__review-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"productPage__review-email\",children:review.user_email}),/*#__PURE__*/_jsx(\"div\",{className:\"productPage__review-stars\",children:Array.from({length:5},(_,starIndex)=>/*#__PURE__*/_jsx(FaStar,{className:starIndex<review.rating?\"productPage__review-star--active\":\"productPage__review-star\"},`star-${review.id}-${starIndex}`))})]}),/*#__PURE__*/_jsx(\"p\",{className:\"productPage__review-content\",children:review.content})]},review.id)):/*#__PURE__*/_jsx(\"p\",{className:\"productPage__no-data\",children:\"No reviews yet for this product.\"})});default:return null;}};return/*#__PURE__*/_jsx(\"section\",{className:\"productPage\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__container\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"productPage__fav-btn\",onClick:handleToggleFavorite,\"aria-label\":favorite?\"Remove from favorites\":\"Add to favorites\",children:favorite?/*#__PURE__*/_jsx(AiFillHeart,{}):/*#__PURE__*/_jsx(AiOutlineHeart,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__top-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__gallery\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__main-image-wrapper\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handlePrevImage,\"aria-label\":\"Previous Image\",className:\"productPage__arrow productPage__arrow--prev\",children:/*#__PURE__*/_jsx(AiOutlineLeft,{})}),/*#__PURE__*/_jsx(\"img\",{src:`${config.apiUrl}/media/${(_product$photos$curre=product.photos[currentIndex])===null||_product$photos$curre===void 0?void 0:_product$photos$curre.path}`,alt:product.name,className:\"productPage__main-img productPage__main-img--clickable\",onClick:handleImageEnlarge}),/*#__PURE__*/_jsx(\"button\",{onClick:handleNextImage,\"aria-label\":\"Next Image\",className:\"productPage__arrow productPage__arrow--next\",children:/*#__PURE__*/_jsx(AiOutlineRight,{})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"productPage__thumbnails\",children:/*#__PURE__*/_jsx(Slider,{...thumbnailSliderSettings,children:product.photos.map((photo,idx)=>{var _ref,_photo$id;return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{src:`${config.apiUrl}/media/${photo.path}`,alt:`Thumbnail ${idx+1}`,className:`productPage__thumbnail ${idx===currentIndex?\"productPage__thumbnail--active\":\"\"}`,onClick:()=>setCurrentIndex(idx)})},`thumb-${(_ref=(_photo$id=photo===null||photo===void 0?void 0:photo.id)!==null&&_photo$id!==void 0?_photo$id:photo===null||photo===void 0?void 0:photo.path)!==null&&_ref!==void 0?_ref:idx}`);})})})]}),isImageEnlarged&&/*#__PURE__*/_jsx(\"div\",{className:\"common-image-overlay\",onClick:closeImageOverlay,children:/*#__PURE__*/_jsxs(\"div\",{className:\"common-image-overlay__content\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"common-close-button\",onClick:()=>setIsImageEnlarged(false),\"aria-label\":\"Close image\",children:\"\\xD7\"}),/*#__PURE__*/_jsx(\"img\",{className:\"common-image-overlay__image\",src:`${config.apiUrl}/media/${(_product$photos$curre2=product.photos[currentIndex])===null||_product$photos$curre2===void 0?void 0:_product$photos$curre2.path}`,alt:product.name})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"productPage__category\",children:product.categories.map(category=>category.replace(/\\./g,\" › \")).join(\", \")}),/*#__PURE__*/_jsx(\"h1\",{className:\"productPage__title\",children:product.name}),product.tags.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"productPage__tags\",children:product.tags.map((tag,index)=>/*#__PURE__*/_jsx(\"span\",{className:\"productPage__tag\",children:tag},`tag-${tag}-${index}`))}),/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__price-section\",children:[product.old_price&&!isNaN(product.old_price)&&/*#__PURE__*/_jsxs(\"span\",{className:\"productPage__old-price\",children:[\"$\",parseFloat(product.old_price).toFixed(2)]}),/*#__PURE__*/_jsxs(\"span\",{className:\"productPage__current-price\",children:[\"$\",parseFloat(product.price).toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"productPage__cart-btn\",onClick:handleAddToCart,children:[\"Add to Cart \",quantityInCart>0&&`(${quantityInCart})`]}),similarProducts.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__quick-recommendations\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"productPage__quick-recommendations-title\",children:\"You May Also Like\"}),/*#__PURE__*/_jsx(\"div\",{className:\"productPage__quick-recommendations-grid\",children:similarProducts.slice(0,3).map(recProduct=>{var _recProduct$photos$;return/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__quick-rec-card\",onClick:()=>navigate(`/product/${recProduct.id}`),children:[/*#__PURE__*/_jsx(\"img\",{src:`${config.apiUrl}/media/${(_recProduct$photos$=recProduct.photos[0])===null||_recProduct$photos$===void 0?void 0:_recProduct$photos$.path}`,alt:recProduct.name,className:\"productPage__quick-rec-img\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__quick-rec-info\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"productPage__quick-rec-name\",children:recProduct.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"productPage__quick-rec-price\",children:[\"$\",parseFloat(recProduct.price).toFixed(2)]})]})]},`quick-rec-${recProduct.id}`);})})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__tabs\",children:[/*#__PURE__*/_jsx(\"button\",{className:`productPage__tab ${activeTab===\"description\"?\"productPage__tab--active\":\"\"}`,onClick:()=>setActiveTab(\"description\"),children:\"Description\"}),/*#__PURE__*/_jsx(\"button\",{className:`productPage__tab ${activeTab===\"specifications\"?\"productPage__tab--active\":\"\"}`,onClick:()=>setActiveTab(\"specifications\"),children:\"Specifications\"}),/*#__PURE__*/_jsxs(\"button\",{className:`productPage__tab ${activeTab===\"reviews\"?\"productPage__tab--active\":\"\"}`,onClick:()=>setActiveTab(\"reviews\"),children:[\"Reviews (\",product.opinions.length,\")\"]})]}),renderTabContent()]}),similarProducts.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__similar-products\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"productPage__similar-products-title\",children:[\"You May Also Like\",getCurrentCategory()&&` in `,/*#__PURE__*/_jsx(\"span\",{children:getCurrentCategory()})]}),similarProductsLoading?/*#__PURE__*/_jsx(\"div\",{className:\"productPage__loading\",children:\"Loading products...\"}):/*#__PURE__*/_jsx(Slider,{...sliderSettings,children:similarProducts.map(similarProduct=>{var _similarProduct$photo,_similarProduct$categ,_similarProduct$categ2;return/*#__PURE__*/_jsx(\"div\",{className:\"productPage__similar-product\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__similar-product-inner\",onClick:()=>navigate(`/product/${similarProduct.id}`),children:[/*#__PURE__*/_jsx(\"img\",{src:`${config.apiUrl}/media/${(_similarProduct$photo=similarProduct.photos[0])===null||_similarProduct$photo===void 0?void 0:_similarProduct$photo.path}`,alt:similarProduct.name,className:\"productPage__similar-product-img\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__similar-product-content\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"productPage__similar-product-category\",children:`CATEGORY: ${((_similarProduct$categ=similarProduct.categories)===null||_similarProduct$categ===void 0?void 0:(_similarProduct$categ2=_similarProduct$categ[0])===null||_similarProduct$categ2===void 0?void 0:_similarProduct$categ2.replace(\".\",\" > \").toUpperCase())||\"N/A\"}`}),/*#__PURE__*/_jsx(\"h3\",{className:\"productPage__similar-product-name\",children:similarProduct.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"productPage__similar-product-prices\",children:[similarProduct.old_price&&!isNaN(similarProduct.old_price)&&/*#__PURE__*/_jsxs(\"span\",{className:\"productPage__similar-product-old-price\",children:[\"$\",parseFloat(similarProduct.old_price).toFixed(2)]}),/*#__PURE__*/_jsxs(\"span\",{className:\"productPage__similar-product-current-price\",children:[\"$\",parseFloat(similarProduct.price).toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"productPage__similar-product-btn\",onClick:e=>{e.stopPropagation();addToCart(similarProduct.id);toast.success(\"Added to Cart\",{position:\"top-center\",autoClose:3000,theme:\"colored\"});},children:[\"ADD TO CART\",\" \",items[similarProduct.id]>0&&/*#__PURE__*/_jsxs(\"span\",{children:[\"(\",items[similarProduct.id],\")\"]})]})]})]})},`similar-${similarProduct.id}`);})})]})]})});};export default ProductPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}