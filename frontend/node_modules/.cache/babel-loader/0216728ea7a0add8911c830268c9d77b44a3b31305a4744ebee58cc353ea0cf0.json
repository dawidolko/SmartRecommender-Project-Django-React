{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{Pie}from\"react-chartjs-2\";import{Link}from\"react-router-dom\";import{Chart as ChartJS,ArcElement,Title,Tooltip,Legend}from\"chart.js\";import{TrendingUp,ShoppingBag,Clock,Heart,Calendar,X}from\"react-feather\";import config from\"../../config/config\";import\"./ClientProbabilistic.scss\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";ChartJS.register(ArcElement,Title,Tooltip,Legend);const Modal=_ref=>{let{isOpen,onClose,title,children}=_ref;if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:title}),/*#__PURE__*/_jsx(\"button\",{className:\"common-modal-close modal-close\",onClick:onClose,\"aria-label\":\"Close modal\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-body\",children:children})]})});};const ClientProbabilistic=()=>{const[activeTab,setActiveTab]=useState(\"recommendations\");const[recommendationsData,setRecommendationsData]=useState([]);const[shoppingProfile,setShoppingProfile]=useState({});const[markovData,setMarkovData]=useState(null);const[bayesianData,setBayesianData]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[modalContent,setModalContent]=useState(null);const[modalTitle,setModalTitle]=useState(\"\");const[isModalOpen,setIsModalOpen]=useState(false);useEffect(()=>{fetchData();},[]);const fetchData=async()=>{const token=localStorage.getItem(\"access\");setLoading(true);setError(null);try{const[insightsRes,markovRes,bayesianRes]=await Promise.all([fetch(`${config.apiUrl}/api/my-shopping-insights/`,{headers:{Authorization:`Bearer ${token}`,\"Content-Type\":\"application/json\"}}),fetch(`${config.apiUrl}/api/markov-recommendations/`,{headers:{Authorization:`Bearer ${token}`,\"Content-Type\":\"application/json\"}}),fetch(`${config.apiUrl}/api/bayesian-insights/`,{headers:{Authorization:`Bearer ${token}`,\"Content-Type\":\"application/json\"}})]);const[insightsData,markovDataRes,bayesianDataRes]=await Promise.all([insightsRes.ok?insightsRes.json():null,markovRes.ok?markovRes.json():null,bayesianRes.ok?bayesianRes.json():null]);if(insightsData){const enhancedRecommendations=(insightsData.personalized_suggestions||[]).map(product=>{const imageUrl=product.photos&&product.photos[0]&&product.photos[0].path?`${config.apiUrl}/media/${product.photos[0].path}`:null;return{...product,image_url:product.image_url||imageUrl||null};});setRecommendationsData(enhancedRecommendations);setShoppingProfile(insightsData.your_shopping_profile||{});}setMarkovData(markovDataRes);setBayesianData(bayesianDataRes);setLoading(false);}catch(error){setError(error.message);setLoading(false);}};const getRecommendationsChartData=()=>{if(!recommendationsData.length){return{labels:[\"No Data\"],datasets:[{data:[1],backgroundColor:[\"#e0e0e0\"]}]};}return{labels:recommendationsData.map(r=>r.name),datasets:[{data:recommendationsData.map(r=>r.match_score),backgroundColor:[\"rgba(255, 99, 132, 0.6)\",\"rgba(54, 162, 235, 0.6)\",\"rgba(255, 206, 86, 0.6)\",\"rgba(75, 192, 192, 0.6)\",\"rgba(153, 102, 255, 0.6)\"],borderWidth:1}]};};const TabButton=_ref2=>{let{id,label,icon:Icon}=_ref2;return/*#__PURE__*/_jsxs(\"button\",{className:`tab-button ${activeTab===id?\"active\":\"\"}`,onClick:()=>setActiveTab(id),children:[/*#__PURE__*/_jsx(Icon,{size:20}),/*#__PURE__*/_jsx(\"span\",{children:label})]});};const showModal=(title,content)=>{setModalTitle(title);setModalContent(content);setIsModalOpen(true);};const closeModal=()=>{setIsModalOpen(false);setModalContent(null);setModalTitle(\"\");};const handleViewMore=type=>{const token=localStorage.getItem(\"access\");switch(type){case\"shopping_profile\":fetch(`${config.apiUrl}/api/purchase-prediction/`,{headers:{Authorization:`Bearer ${token}`,\"Content-Type\":\"application/json\"}}).then(res=>res.json()).then(data=>{var _data$predictions;const modalContent=/*#__PURE__*/_jsxs(\"div\",{className:\"profile-details\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Your Shopping Profile\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Based on your purchase history and browsing patterns, our system has built a probabilistic profile of your shopping preferences.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile-stats\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Favorite Category\"}),/*#__PURE__*/_jsx(\"p\",{children:shoppingProfile.favorite_category||\"Not enough data\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Best Time to Shop\"}),/*#__PURE__*/_jsx(\"p\",{children:shoppingProfile.best_shopping_time||\"Anytime\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Potential Savings\"}),/*#__PURE__*/_jsx(\"p\",{children:shoppingProfile.savings_potential||\"Unknown\"})]})]}),/*#__PURE__*/_jsx(\"h3\",{children:\"Product Preferences\"}),/*#__PURE__*/_jsx(\"div\",{className:\"product-preferences\",children:(_data$predictions=data.predictions)===null||_data$predictions===void 0?void 0:_data$predictions.map((item,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"preference-item\",children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:item.name})}),/*#__PURE__*/_jsxs(\"div\",{className:\"probability-bar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"probability-fill\",style:{width:`${item.purchase_probability}%`}}),/*#__PURE__*/_jsxs(\"span\",{children:[item.purchase_probability,\"%\"]})]})]},idx))})]});showModal(\"YOUR SHOPPING PROFILE\",modalContent);}).catch(error=>{showModal(\"Error\",/*#__PURE__*/_jsxs(\"p\",{children:[\"Failed to load profile details: \",error.message]}));});break;default:break;}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"});}if(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"error\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Error loading data:\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:fetchData,className:\"retry-button\",children:\"Retry\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"client-probabilistic\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"probabilistic-tabs\",children:[/*#__PURE__*/_jsx(TabButton,{id:\"recommendations\",label:\"Personal Recommendations\",icon:Heart}),/*#__PURE__*/_jsx(TabButton,{id:\"profile\",label:\"Shopping Profile\",icon:ShoppingBag}),/*#__PURE__*/_jsx(TabButton,{id:\"markov\",label:\"Next Purchase (Markov)\",icon:Clock}),/*#__PURE__*/_jsx(TabButton,{id:\"bayesian\",label:\"Behavior Insights (Bayesian)\",icon:TrendingUp})]}),/*#__PURE__*/_jsx(Modal,{isOpen:isModalOpen,onClose:closeModal,title:modalTitle,children:modalContent}),/*#__PURE__*/_jsxs(\"div\",{className:\"tab-content\",children:[activeTab===\"recommendations\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"recommendations-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Your Personalized Recommendations\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Based on your purchasing patterns and preferences, we've selected these items for you.\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"recommendations-chart\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chart-container\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Match Score\"}),/*#__PURE__*/_jsx(Pie,{data:getRecommendationsChartData(),options:{responsive:true,plugins:{legend:{position:\"bottom\"}}}})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"recommendations-list\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Recommended Products\"}),/*#__PURE__*/_jsx(\"div\",{className:\"products-grid\",children:recommendationsData.map((product,idx)=>/*#__PURE__*/_jsx(Link,{to:`/product/${product.id}`,className:\"product-card-link\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"product-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"product-image\",children:product.image_url?/*#__PURE__*/_jsx(\"img\",{src:product.image_url,alt:product.name}):/*#__PURE__*/_jsx(\"div\",{className:\"placeholder-image\",children:product.name.substring(0,2).toUpperCase()})}),/*#__PURE__*/_jsxs(\"div\",{className:\"product-details\",children:[/*#__PURE__*/_jsx(\"h4\",{children:product.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"product-price\",children:[\"$\",product.price]}),/*#__PURE__*/_jsxs(\"div\",{className:\"match-score\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"score-label\",children:\"Match Score:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"score-bar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"score-fill\",style:{width:`${product.match_score}%`}}),/*#__PURE__*/_jsxs(\"span\",{children:[product.match_score,\"%\"]})]})]})]})]})},idx))})]})]}),activeTab===\"profile\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"profile-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Your Shopping Profile\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Our probabilistic models have analyzed your shopping behavior to create your unique profile.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile-cards\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Favorite Category\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"highlight\",children:shoppingProfile.favorite_category||\"Not enough data yet\"}),/*#__PURE__*/_jsx(\"p\",{className:\"subtext\",children:\"Based on your purchase frequency and volume\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Best Shopping Time\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"highlight\",children:shoppingProfile.best_shopping_time||\"Any time\"}),/*#__PURE__*/_jsx(\"p\",{className:\"subtext\",children:\"When you typically make your purchases\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Potential Savings\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"highlight\",children:shoppingProfile.savings_potential||\"Calculate your potential\"}),/*#__PURE__*/_jsx(\"p\",{className:\"subtext\",children:\"By optimizing your shopping timing and patterns\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"view-more-container\",children:/*#__PURE__*/_jsx(\"button\",{className:\"view-more-button\",onClick:()=>handleViewMore(\"shopping_profile\"),children:\"View Detailed Analysis\"})})]}),activeTab===\"markov\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"markov-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Next Purchase Predictions\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Our Markov chain models analyze your shopping sequences to predict what you're likely to buy next.\"})]}),markovData?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-cards\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Next Purchase Probability\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"probability-display\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"probability-value\",children:[Math.round(markovData.next_purchase_probability*100),\"%\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"probability-label\",children:\"within 30 days\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Expected Days Until Next Purchase\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"days-display\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"days-value\",children:markovData.expected_days_to_next_purchase||\"N/A\"}),/*#__PURE__*/_jsx(\"span\",{className:\"days-label\",children:\"days\"})]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sequence-predictions\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Likely Next Products\"}),/*#__PURE__*/_jsx(\"div\",{className:\"products-grid\",children:markovData.predicted_products&&markovData.predicted_products.map((product,idx)=>/*#__PURE__*/_jsx(Link,{to:`/product/${product.id}`,className:\"product-card-link\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"product-card prediction-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"product-image\",children:product.image_url?/*#__PURE__*/_jsx(\"img\",{src:product.image_url,alt:product.name}):/*#__PURE__*/_jsx(\"div\",{className:\"placeholder-image\",children:product.name.substring(0,2).toUpperCase()})}),/*#__PURE__*/_jsxs(\"div\",{className:\"product-details\",children:[/*#__PURE__*/_jsx(\"h4\",{children:product.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"product-price\",children:[\"$\",product.price]}),/*#__PURE__*/_jsxs(\"div\",{className:\"prediction-score\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"score-label\",children:\"Prediction Score:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"score-bar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"score-fill\",style:{width:`${product.prediction_score*100}%`}}),/*#__PURE__*/_jsxs(\"span\",{children:[Math.round(product.prediction_score*100),\"%\"]})]})]})]})]})},idx))})]}),markovData.sequence_analysis&&/*#__PURE__*/_jsxs(\"div\",{className:\"sequence-analysis\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Your Shopping Patterns\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"pattern-insights\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"insight-item\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Most Common Sequence\"}),/*#__PURE__*/_jsx(\"p\",{children:markovData.sequence_analysis.most_common_sequence||\"Not enough data\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"insight-item\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Purchase Cycle Length\"}),/*#__PURE__*/_jsxs(\"p\",{children:[markovData.sequence_analysis.average_cycle_length||\"N/A\",\" \",\"products per cycle\"]})]})]})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"no-data\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Not enough purchase data to generate Markov predictions. Make a few more purchases to see personalized insights!\"})})]}),activeTab===\"bayesian\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"bayesian-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Behavioral Insights\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Our Bayesian models analyze your behavior patterns to provide deep insights into your shopping preferences.\"})]}),bayesianData?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"insights-cards\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"insight-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Purchase Likelihood\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsx(\"div\",{className:\"likelihood-chart\",children:bayesianData.category_preferences&&Object.entries(bayesianData.category_preferences).map((_ref3,idx)=>{let[category,likelihood]=_ref3;return/*#__PURE__*/_jsxs(\"div\",{className:\"likelihood-bar\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"category-name\",children:category}),/*#__PURE__*/_jsxs(\"div\",{className:\"bar-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bar-fill\",style:{width:`${likelihood*100}%`}}),/*#__PURE__*/_jsxs(\"span\",{className:\"likelihood-value\",children:[Math.round(likelihood*100),\"%\"]})]})]},idx);})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"insight-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Churn Risk Analysis\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"churn-display\",children:[/*#__PURE__*/_jsxs(\"div\",{className:`churn-indicator ${bayesianData.churn_risk<0.3?\"low\":bayesianData.churn_risk<0.7?\"medium\":\"high\"}`,children:[/*#__PURE__*/_jsxs(\"span\",{className:\"churn-percentage\",children:[Math.round(bayesianData.churn_risk*100),\"%\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"churn-label\",children:bayesianData.churn_risk<0.3?\"Low Risk\":bayesianData.churn_risk<0.7?\"Medium Risk\":\"High Risk\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"churn-explanation\",children:bayesianData.churn_risk<0.3?\"You are a loyal customer with consistent shopping patterns.\":bayesianData.churn_risk<0.7?\"Your shopping frequency has decreased slightly. Consider exploring new products!\":\"We miss you! Check out our latest offers to rediscover great products.\"})]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"behavioral-patterns\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Shopping Behavior Analysis\"}),/*#__PURE__*/_jsx(\"div\",{className:\"patterns-grid\",children:bayesianData.behavioral_insights&&bayesianData.behavioral_insights.map((insight,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"pattern-card\",children:[/*#__PURE__*/_jsx(\"h4\",{children:insight.pattern_name}),/*#__PURE__*/_jsx(\"p\",{className:\"pattern-description\",children:insight.description}),/*#__PURE__*/_jsx(\"div\",{className:\"pattern-confidence\",children:/*#__PURE__*/_jsxs(\"span\",{children:[\"Confidence: \",Math.round(insight.confidence*100),\"%\"]})})]},idx))})]}),bayesianData.recommendations&&/*#__PURE__*/_jsxs(\"div\",{className:\"bayesian-recommendations\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Personalized Suggestions\"}),/*#__PURE__*/_jsx(\"div\",{className:\"suggestions-list\",children:bayesianData.recommendations.map((rec,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"suggestion-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"suggestion-icon\",children:\"\\uD83D\\uDCA1\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"suggestion-content\",children:[/*#__PURE__*/_jsx(\"h4\",{children:rec.title}),/*#__PURE__*/_jsx(\"p\",{children:rec.description}),/*#__PURE__*/_jsxs(\"span\",{className:\"suggestion-confidence\",children:[\"Confidence: \",Math.round(rec.confidence*100),\"%\"]})]})]},idx))})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"no-data\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Not enough behavioral data to generate insights. Continue shopping to see personalized behavioral analysis!\"})})]})]})]});};export default ClientProbabilistic;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}