{"ast":null,"code":"/**\n * CartContent Component\n *\n * Authors: Dawid Olko & Piotr Smoła\n * Date: 2025-11-02\n * Version: 2.0\n *\n * Shopping cart page component that displays cart items, calculates totals,\n * and provides product recommendations based on cart contents.\n *\n * Features:\n *   - Display all items in shopping cart\n *   - Quantity management (increase/decrease/remove)\n *   - Real-time total amount calculation\n *   - Cart persistence in localStorage\n *   - \"Frequently Bought Together\" recommendations (Association Rules)\n *   - Image enlargement modal for product images\n *   - Checkout navigation\n *   - Empty cart state\n *\n * Recommendation Algorithm:\n *   - Uses Apriori Association Rules (backend)\n *   - Analyzes products currently in cart\n *   - Suggests products frequently bought together\n *   - Formula: If {A, B} in cart → Recommend {C} with confidence > 0.5\n *\n * State Management:\n *   - items: Cart items from CartContext (id → quantity mapping)\n *   - shopData: Full product catalog for displaying recommendations\n *   - recommendations: Products suggested based on cart contents\n *   - recommendationsLoading: Loading state for recommendations API\n *   - enlargedImage: Currently viewed enlarged product image\n *   - totalAmount: Calculated from CartContext\n *\n * API Endpoints:\n *   - GET /api/products/ - Fetch all products for recommendations\n *   - GET /api/frequently-bought-together/?product_ids[]={ids} - Get recommendations\n *\n * Cart Persistence:\n *   - Saves to localStorage on every cart change\n *   - Format: {\"productId\": quantity, ...}\n *   - Restores on component mount\n *\n * @component\n * @returns {React.ReactElement} Shopping cart page with recommendations\n *//* eslint-disable react-hooks/exhaustive-deps */import\"./CartContent.scss\";import{useContext,useEffect,useState}from\"react\";import{CartContext}from\"../ShopContext/ShopContext\";import CartProduct from\"./CartProduct\";import TotalAmount from\"./TotalAmount\";import axios from\"axios\";import{useNavigate}from\"react-router-dom\";import{toast}from\"react-toastify\";import config from\"../../config/config\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CartContent=()=>{const{items,totalAmount,removeFromCart,addToCart}=useContext(CartContext);const[shopData,setShopData]=useState([]);const navigate=useNavigate();const[recommendations,setRecommendations]=useState([]);const[recommendationsLoading,setRecommendationsLoading]=useState(false);const[enlargedImage,setEnlargedImage]=useState(null);useEffect(()=>{const fetchProducts=async()=>{try{const response=await axios.get(`${config.apiUrl}/api/products/`);setShopData(response.data);}catch(error){console.error(\"Error fetching products:\",error);}};fetchProducts();},[]);useEffect(()=>{localStorage.setItem(\"cart\",JSON.stringify(items));},[items]);useEffect(()=>{if(Object.keys(items).length>0){fetchRecommendations();}else{setRecommendations([]);}},[items]);const fetchRecommendations=async()=>{setRecommendationsLoading(true);try{const productIds=Object.keys(items).filter(id=>items[id]>0);if(productIds.length===0)return;const params=new URLSearchParams();productIds.forEach(id=>params.append(\"product_ids[]\",id));const response=await axios.get(`${config.apiUrl}/api/frequently-bought-together/?${params.toString()}`);if(!response.data||response.data.length===0){console.warn(\"⚠️ No recommendations found for these products. Association rules may not be generated yet.\");}setRecommendations(response.data);}catch(error){console.error(\"❌ Error fetching cart recommendations:\",error);}finally{setRecommendationsLoading(false);}};const handleAddToCart=productId=>{addToCart(productId);toast.success(\"Added to Cart\",{position:\"top-center\",autoClose:3000,theme:\"colored\"});};const handleImageClick=(imageUrl,productName)=>{setEnlargedImage({url:imageUrl,name:productName});};const closeImageOverlay=()=>{setEnlargedImage(null);};const handleProductClick=productId=>{navigate(`/product/${productId}`);};return/*#__PURE__*/_jsx(\"div\",{className:\"cart container\",children:totalAmount()>0?/*#__PURE__*/_jsxs(\"div\",{className:\"cart__container\",children:[/*#__PURE__*/_jsxs(\"table\",{className:\"cart__table\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"cart__thead\",children:/*#__PURE__*/_jsxs(\"tr\",{className:\"cart__row\",children:[/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Product\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Quantity\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Total Price\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:\"center\"},children:\"Remove\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:shopData.map(product=>{if(items[product.id]>0){return/*#__PURE__*/_jsx(CartProduct,{...product,removeItemFromCart:removeFromCart},product.id);}return null;})})]}),totalAmount()>0&&recommendations.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"cart__recommendations\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"cart__recommendations-title\",children:\"Frequently Bought Together\"}),recommendationsLoading?/*#__PURE__*/_jsx(\"div\",{className:\"cart__recommendations-loading\",children:\"Loading...\"}):/*#__PURE__*/_jsx(\"div\",{className:\"cart__recommendations-grid\",children:recommendations.map((rec,index)=>{var _rec$product$photos$;const imageUrl=`${config.apiUrl}/media/${(_rec$product$photos$=rec.product.photos[0])===null||_rec$product$photos$===void 0?void 0:_rec$product$photos$.path}`;return/*#__PURE__*/_jsxs(\"div\",{className:\"cart__recommendation-item\",children:[/*#__PURE__*/_jsx(\"img\",{src:imageUrl,alt:rec.product.name,className:\"cart__recommendation-image\",onClick:()=>handleImageClick(imageUrl,rec.product.name)}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart__recommendation-info\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"cart__recommendation-name\",onClick:()=>handleProductClick(rec.product.id),children:rec.product.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"cart__recommendation-price\",children:[\"$\",rec.product.price]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart__recommendation-stats\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"stat-confidence\",children:[\"Confidence: \",(rec.confidence*100).toFixed(0),\"%\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-lift\",children:[\"Lift: \",rec.lift.toFixed(2),\"x\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-support\",children:[\"Support: \",(rec.support*100).toFixed(1),\"%\"]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"cart__recommendation-button\",onClick:()=>handleAddToCart(rec.product.id),children:\"Add to Cart\"})]})]},index);})})]}),enlargedImage&&/*#__PURE__*/_jsx(\"div\",{className:\"common-image-overlay\",onClick:closeImageOverlay,children:/*#__PURE__*/_jsxs(\"div\",{className:\"common-image-overlay__content\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"common-close-button\",onClick:closeImageOverlay,\"aria-label\":\"Close image\",children:\"\\xD7\"}),/*#__PURE__*/_jsx(\"img\",{className:\"common-image-overlay__image\",src:enlargedImage.url,alt:enlargedImage.name})]})}),/*#__PURE__*/_jsx(TotalAmount,{})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"cart__empty\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"cart__empty-title\",children:\"Your cart is empty\"}),/*#__PURE__*/_jsx(\"button\",{className:\"cart__empty-btn\",onClick:()=>navigate(\"/shop\"),children:\"Go To Shopping\"})]})});};export default CartContent;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}