{"ast":null,"code":"/* eslint-disable react-hooks/exhaustive-deps */import React,{useState,useEffect,useCallback}from\"react\";import axios from\"axios\";import{Star,AlertCircle}from\"lucide-react\";import{toast}from\"react-toastify\";import\"react-toastify/dist/ReactToastify.css\";import config from\"../../config/config\";import\"./ReviewForm.scss\";import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const parseJwt=token=>{try{const base64Url=token.split(\".\")[1];const base64=base64Url.replace(/-/g,\"+\").replace(/_/g,\"/\");return JSON.parse(atob(base64));}catch{return{};}};const ReviewForm=_ref=>{var _parseJwt,_product$name;let{product=null,onReviewSubmitted,onClose}=_ref;const[rating,setRating]=useState(0);const[hoverRating,setHoverRating]=useState(0);const[review,setReview]=useState(\"\");const[error,setError]=useState(\"\");const[loading,setLoading]=useState(false);const[submitted,setSubmitted]=useState(false);const token=localStorage.getItem(\"access\");const currentUserEmail=token?(_parseJwt=parseJwt(token))===null||_parseJwt===void 0?void 0:_parseJwt.email:null;useEffect(()=>{setRating(0);setHoverRating(0);setReview(\"\");setError(\"\");setLoading(false);setSubmitted(false);if(!(product!==null&&product!==void 0&&product.id)||!currentUserEmail)return;axios.get(`${config.apiUrl}/api/products/${product.id}/reviews/`,{headers:{Authorization:token?`Bearer ${token}`:undefined}}).then(res=>{const already=res.data.some(r=>r.user_email===currentUserEmail);if(already)setSubmitted(true);}).catch(()=>{});},[product===null||product===void 0?void 0:product.id]);const validateForm=useCallback(()=>{if(!rating)return\"Please select a rating before submitting\";if(!review.trim())return\"Please write a review before submitting\";if(review.trim().length<3)return\"Review is too short. Please write at least 3 characters\";return\"\";},[rating,review]);const handleSubmit=async e=>{e.preventDefault();if(submitted)return;const validationMsg=validateForm();if(validationMsg){setError(validationMsg);return;}if(!(product!==null&&product!==void 0&&product.id)){setError(\"Invalid product information. Please try again later.\");return;}setLoading(true);setError(\"\");const url=`${config.apiUrl}/api/products/${product.id}/reviews/`;try{const resp=await axios.post(url,{rating,content:review},{headers:{Authorization:token?`Bearer ${token}`:undefined}});onReviewSubmitted===null||onReviewSubmitted===void 0?void 0:onReviewSubmitted(resp.data);setSubmitted(true);setLoading(false);toast.success(\"Review added â€“ thank you!\");setTimeout(()=>onClose===null||onClose===void 0?void 0:onClose(),2500);}catch(err){var _err$response;const apiData=(_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.data;let msg=\"Failed to submit your review. Please try again later.\";if(apiData!==null&&apiData!==void 0&&apiData.detail){if(apiData.detail===\"A review has already been added for this product.\"){toast.error(apiData.detail);setLoading(false);setTimeout(()=>onClose===null||onClose===void 0?void 0:onClose(),1000);return;}msg=apiData.detail;}else if(apiData){msg=Object.values(apiData).flat().join(\" \");}setError(msg);setLoading(false);toast.error(msg);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"review-form-container\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Write a Review for \",(_product$name=product===null||product===void 0?void 0:product.name)!==null&&_product$name!==void 0?_product$name:\"Product\"]}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"review-form-error\",children:[/*#__PURE__*/_jsx(AlertCircle,{size:18}),/*#__PURE__*/_jsx(\"span\",{children:error})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rating-container\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Your Rating:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"stars-container\",children:[1,2,3,4,5].map(star=>/*#__PURE__*/_jsx(Star,{size:28,onClick:()=>!loading&&!submitted&&setRating(star),onMouseEnter:()=>!loading&&!submitted&&setHoverRating(star),onMouseLeave:()=>!loading&&!submitted&&setHoverRating(0),fill:star<=(hoverRating||rating)?\"#FFD700\":\"none\",stroke:star<=(hoverRating||rating)?\"#FFD700\":\"#ccc\",className:\"star-icon\",style:{cursor:loading||submitted?\"not-allowed\":\"pointer\"}},star))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"review-text-container\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"review-text\",children:\"Your Review:\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"review-text\",placeholder:\"What did you think about this product? (minimum 3 characters)\",value:review,onChange:e=>{setReview(e.target.value);if(error)setError(\"\");},rows:4,disabled:loading||submitted})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"review-form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-secondary\",onClick:onClose,disabled:loading,children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn-primary\",disabled:loading||submitted,children:loading?\"Submitting...\":submitted?\"Submitted\":\"Submit Review\"})]})]})]});};export default ReviewForm;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}